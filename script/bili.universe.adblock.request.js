// Mon Aug 18 2025 21:20:03 GMT+0000 (Coordinated Universal Time) https://raw.githubusercontent.com/ElementRef/AboutConfig/main/script/bili.universe.adblock.request.js
(()=>{var X={249:function($,A,f){var E,P;E=0,P=function(){var B=B||(function(N,v){if(typeof window<"u"&&window.crypto&&(D=window.crypto),typeof self<"u"&&self.crypto&&(D=self.crypto),typeof globalThis<"u"&&globalThis.crypto&&(D=globalThis.crypto),!D&&typeof window<"u"&&window.msCrypto&&(D=window.msCrypto),!D&&f.g!==void 0&&f.g.crypto&&(D=f.g.crypto),!D)try{D=f(761)}catch{}var D,O=function(){if(D){if(typeof D.getRandomValues=="function")try{return D.getRandomValues(new Uint32Array(1))[0]}catch{}if(typeof D.randomBytes=="function")try{return D.randomBytes(4).readInt32LE()}catch{}}throw Error("Native crypto module could not be used to get secure random number.")},F=Object.create||(function(){function s(){}return function(d){var g;return s.prototype=d,g=new s,s.prototype=null,g}})(),i={},T=i.lib={},k=T.Base={extend:function(s){var d=F(this);return s&&d.mixIn(s),(!d.hasOwnProperty("init")||this.init===d.init)&&(d.init=function(){d.$super.init.apply(this,arguments)}),d.init.prototype=d,d.$super=this,d},create:function(){var s=this.extend();return s.init.apply(s,arguments),s},init:function(){},mixIn:function(s){for(var d in s)s.hasOwnProperty(d)&&(this[d]=s[d]);s.hasOwnProperty("toString")&&(this.toString=s.toString)},clone:function(){return this.init.prototype.extend(this)}},a=T.WordArray=k.extend({init:function(s,d){s=this.words=s||[],v!=d?this.sigBytes=d:this.sigBytes=4*s.length},toString:function(s){return(s||t).stringify(this)},concat:function(s){var d=this.words,g=s.words,h=this.sigBytes,w=s.sigBytes;if(this.clamp(),h%4)for(var b=0;b<w;b++){var x=g[b>>>2]>>>24-b%4*8&255;d[h+b>>>2]|=x<<24-(h+b)%4*8}else for(var m=0;m<w;m+=4)d[h+m>>>2]=g[m>>>2];return this.sigBytes+=w,this},clamp:function(){var s=this.words,d=this.sigBytes;s[d>>>2]&=4294967295<<32-d%4*8,s.length=N.ceil(d/4)},clone:function(){var s=k.clone.call(this);return s.words=this.words.slice(0),s},random:function(s){for(var d=[],g=0;g<s;g+=4)d.push(O());return new a.init(d,s)}}),e=i.enc={},t=e.Hex={stringify:function(s){for(var d=s.words,g=s.sigBytes,h=[],w=0;w<g;w++){var b=d[w>>>2]>>>24-w%4*8&255;h.push((b>>>4).toString(16)),h.push((15&b).toString(16))}return h.join("")},parse:function(s){for(var d=s.length,g=[],h=0;h<d;h+=2)g[h>>>3]|=parseInt(s.substr(h,2),16)<<24-h%8*4;return new a.init(g,d/2)}},r=e.Latin1={stringify:function(s){for(var d=s.words,g=s.sigBytes,h=[],w=0;w<g;w++){var b=d[w>>>2]>>>24-w%4*8&255;h.push(String.fromCharCode(b))}return h.join("")},parse:function(s){for(var d=s.length,g=[],h=0;h<d;h++)g[h>>>2]|=(255&s.charCodeAt(h))<<24-h%4*8;return new a.init(g,d)}},n=e.Utf8={stringify:function(s){try{return decodeURIComponent(escape(r.stringify(s)))}catch{throw Error("Malformed UTF-8 data")}},parse:function(s){return r.parse(unescape(encodeURIComponent(s)))}},p=T.BufferedBlockAlgorithm=k.extend({reset:function(){this._data=new a.init,this._nDataBytes=0},_append:function(s){typeof s=="string"&&(s=n.parse(s)),this._data.concat(s),this._nDataBytes+=s.sigBytes},_process:function(s){var d,g=this._data,h=g.words,w=g.sigBytes,b=this.blockSize,x=w/(4*b),m=(x=s?N.ceil(x):N.max((0|x)-this._minBufferSize,0))*b,S=N.min(4*m,w);if(m){for(var C=0;C<m;C+=b)this._doProcessBlock(h,C);d=h.splice(0,m),g.sigBytes-=S}return new a.init(d,S)},clone:function(){var s=k.clone.call(this);return s._data=this._data.clone(),s},_minBufferSize:0});T.Hasher=p.extend({cfg:k.extend(),init:function(s){this.cfg=this.cfg.extend(s),this.reset()},reset:function(){p.reset.call(this),this._doReset()},update:function(s){return this._append(s),this._process(),this},finalize:function(s){return s&&this._append(s),this._doFinalize()},blockSize:16,_createHelper:function(s){return function(d,g){return new s.init(g).finalize(d)}},_createHmacHelper:function(s){return function(d,g){return new y.HMAC.init(s,g).finalize(d)}}});var y=i.algo={};return i})(Math);return B},$.exports=P()},214:function($,A,f){var E,P;E=0,P=function(B){return(function(N){var v=B.lib,D=v.WordArray,O=v.Hasher,F=B.algo,i=[];(function(){for(var r=0;r<64;r++)i[r]=4294967296*N.abs(N.sin(r+1))|0})();var T=F.MD5=O.extend({_doReset:function(){this._hash=new D.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(r,n){for(var p=0;p<16;p++){var y=n+p,s=r[y];r[y]=(s<<8|s>>>24)&16711935|(s<<24|s>>>8)&4278255360}var d=this._hash.words,g=r[n+0],h=r[n+1],w=r[n+2],b=r[n+3],x=r[n+4],m=r[n+5],S=r[n+6],C=r[n+7],j=r[n+8],R=r[n+9],I=r[n+10],q=r[n+11],M=r[n+12],U=r[n+13],H=r[n+14],V=r[n+15],o=d[0],c=d[1],u=d[2],l=d[3];o=k(o,c,u,l,g,7,i[0]),l=k(l,o,c,u,h,12,i[1]),u=k(u,l,o,c,w,17,i[2]),c=k(c,u,l,o,b,22,i[3]),o=k(o,c,u,l,x,7,i[4]),l=k(l,o,c,u,m,12,i[5]),u=k(u,l,o,c,S,17,i[6]),c=k(c,u,l,o,C,22,i[7]),o=k(o,c,u,l,j,7,i[8]),l=k(l,o,c,u,R,12,i[9]),u=k(u,l,o,c,I,17,i[10]),c=k(c,u,l,o,q,22,i[11]),o=k(o,c,u,l,M,7,i[12]),l=k(l,o,c,u,U,12,i[13]),u=k(u,l,o,c,H,17,i[14]),c=k(c,u,l,o,V,22,i[15]),o=a(o,c,u,l,h,5,i[16]),l=a(l,o,c,u,S,9,i[17]),u=a(u,l,o,c,q,14,i[18]),c=a(c,u,l,o,g,20,i[19]),o=a(o,c,u,l,m,5,i[20]),l=a(l,o,c,u,I,9,i[21]),u=a(u,l,o,c,V,14,i[22]),c=a(c,u,l,o,x,20,i[23]),o=a(o,c,u,l,R,5,i[24]),l=a(l,o,c,u,H,9,i[25]),u=a(u,l,o,c,b,14,i[26]),c=a(c,u,l,o,j,20,i[27]),o=a(o,c,u,l,U,5,i[28]),l=a(l,o,c,u,w,9,i[29]),u=a(u,l,o,c,C,14,i[30]),c=a(c,u,l,o,M,20,i[31]),o=e(o,c,u,l,m,4,i[32]),l=e(l,o,c,u,j,11,i[33]),u=e(u,l,o,c,q,16,i[34]),c=e(c,u,l,o,H,23,i[35]),o=e(o,c,u,l,h,4,i[36]),l=e(l,o,c,u,x,11,i[37]),u=e(u,l,o,c,C,16,i[38]),c=e(c,u,l,o,I,23,i[39]),o=e(o,c,u,l,U,4,i[40]),l=e(l,o,c,u,g,11,i[41]),u=e(u,l,o,c,b,16,i[42]),c=e(c,u,l,o,S,23,i[43]),o=e(o,c,u,l,R,4,i[44]),l=e(l,o,c,u,M,11,i[45]),u=e(u,l,o,c,V,16,i[46]),c=e(c,u,l,o,w,23,i[47]),o=t(o,c,u,l,g,6,i[48]),l=t(l,o,c,u,C,10,i[49]),u=t(u,l,o,c,H,15,i[50]),c=t(c,u,l,o,m,21,i[51]),o=t(o,c,u,l,M,6,i[52]),l=t(l,o,c,u,b,10,i[53]),u=t(u,l,o,c,I,15,i[54]),c=t(c,u,l,o,h,21,i[55]),o=t(o,c,u,l,j,6,i[56]),l=t(l,o,c,u,V,10,i[57]),u=t(u,l,o,c,S,15,i[58]),c=t(c,u,l,o,U,21,i[59]),o=t(o,c,u,l,x,6,i[60]),l=t(l,o,c,u,q,10,i[61]),u=t(u,l,o,c,w,15,i[62]),c=t(c,u,l,o,R,21,i[63]),d[0]=d[0]+o|0,d[1]=d[1]+c|0,d[2]=d[2]+u|0,d[3]=d[3]+l|0},_doFinalize:function(){var r=this._data,n=r.words,p=8*this._nDataBytes,y=8*r.sigBytes;n[y>>>5]|=128<<24-y%32;var s=N.floor(p/4294967296);n[(y+64>>>9<<4)+15]=(s<<8|s>>>24)&16711935|(s<<24|s>>>8)&4278255360,n[(y+64>>>9<<4)+14]=(p<<8|p>>>24)&16711935|(p<<24|p>>>8)&4278255360,r.sigBytes=(n.length+1)*4,this._process();for(var d=this._hash,g=d.words,h=0;h<4;h++){var w=g[h];g[h]=(w<<8|w>>>24)&16711935|(w<<24|w>>>8)&4278255360}return d},clone:function(){var r=O.clone.call(this);return r._hash=this._hash.clone(),r}});function k(r,n,p,y,s,d,g){var h=r+(n&p|~n&y)+s+g;return(h<<d|h>>>32-d)+n}function a(r,n,p,y,s,d,g){var h=r+(n&y|p&~y)+s+g;return(h<<d|h>>>32-d)+n}function e(r,n,p,y,s,d,g){var h=r+(n^p^y)+s+g;return(h<<d|h>>>32-d)+n}function t(r,n,p,y,s,d,g){var h=r+(p^(n|~y))+s+g;return(h<<d|h>>>32-d)+n}B.MD5=O._createHelper(T),B.HmacMD5=O._createHmacHelper(T)})(Math),B.MD5},$.exports=P(f(249))},761:function(){}},W={};function L($){var A=W[$];if(A!==void 0)return A.exports;var f=W[$]={exports:{}};return X[$].call(f.exports,f,f.exports,L),f.exports}L.g=(function(){if(typeof globalThis=="object")return globalThis;try{return this||Function("return this")()}catch{if(typeof window=="object")return window}})(),L.rv=function(){return"1.1.8"},L.ruid="bundler=rspack@1.1.8",(()=>{"use strict";let $,A=(()=>{let a=Object.keys(globalThis);switch(!0){case a.includes("$task"):return"Quantumult X";case a.includes("$loon"):return"Loon";case a.includes("$rocket"):return"Shadowrocket";case typeof module<"u":return"Node.js";case a.includes("Egern"):return"Egern";case a.includes("$environment"):return $environment["surge-version"]?"Surge":$environment["stash-version"]?"Stash":void 0;default:return}})();class f{static#e=new Map([]);static#s=[];static#a=new Map([]);static clear=()=>{};static count=(e="default")=>{switch(f.#e.has(e)){case!0:f.#e.set(e,f.#e.get(e)+1);break;case!1:f.#e.set(e,0)}f.log(`${e}: ${f.#e.get(e)}`)};static countReset=(e="default")=>{switch(f.#e.has(e)){case!0:f.#e.set(e,0),f.log(`${e}: ${f.#e.get(e)}`);break;case!1:f.warn(`Counter "${e}" doesn\u2019t exist`)}};static debug=(...e)=>{!(f.#t<4)&&(e=e.map(t=>`\u{1F171}\uFE0F ${t}`),f.log(...e))};static error(...e){if(!(f.#t<1)){switch(A){case"Surge":case"Loon":case"Stash":case"Egern":case"Shadowrocket":case"Quantumult X":default:e=e.map(t=>`\u274C ${t}`);break;case"Node.js":e=e.map(t=>`\u274C ${t.stack}`)}f.log(...e)}}static exception=(...e)=>f.error(...e);static group=e=>f.#s.unshift(e);static groupEnd=()=>f.#s.shift();static info(...e){!(f.#t<3)&&(e=e.map(t=>`\u2139\uFE0F ${t}`),f.log(...e))}static#t=3;static get logLevel(){switch(f.#t){case 0:return"OFF";case 1:return"ERROR";case 2:return"WARN";case 3:default:return"INFO";case 4:return"DEBUG";case 5:return"ALL"}}static set logLevel(e){switch(typeof e){case"string":e=e.toLowerCase();break;case"number":break;default:e="warn"}switch(e){case 0:case"off":f.#t=0;break;case 1:case"error":f.#t=1;break;case 2:case"warn":case"warning":default:f.#t=2;break;case 3:case"info":f.#t=3;break;case 4:case"debug":f.#t=4;break;case 5:case"all":f.#t=5}}static log=(...e)=>{f.#t!==0&&(e=e.map(t=>{switch(typeof t){case"object":t=JSON.stringify(t);break;case"bigint":case"number":case"boolean":case"string":t=t.toString()}return t}),f.#s.forEach(t=>{(e=e.map(r=>`  ${r}`)).unshift(`\u25BC ${t}:`)}))};static time=(e="default")=>f.#a.set(e,Date.now());static timeEnd=(e="default")=>f.#a.delete(e);static timeLog=(e="default")=>{let t=f.#a.get(e);t?f.log(`${e}: ${Date.now()-t}ms`):f.warn(`Timer "${e}" doesn\u2019t exist`)};static warn(...e){!(f.#t<2)&&(e=e.map(t=>`\u26A0\uFE0F ${t}`),f.log(...e))}}class E{static escape(e){let t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};return e.replace(/[&<>"']/g,r=>t[r])}static get(e={},t="",r){!Array.isArray(t)&&(t=E.toPath(t));let n=t.reduce((p,y)=>Object(p)[y],e);return n===void 0?r:n}static omit(e={},t=[]){return!Array.isArray(t)&&(t=[t.toString()]),t.forEach(r=>E.unset(e,r)),e}static pick(e={},t=[]){return!Array.isArray(t)&&(t=[t.toString()]),Object.fromEntries(Object.entries(e).filter(([r,n])=>t.includes(r)))}static set(e,t,r){return!Array.isArray(t)&&(t=E.toPath(t)),t.slice(0,-1).reduce((n,p,y)=>Object(n[p])===n[p]?n[p]:n[p]=/^\d+$/.test(t[y+1])?[]:{},e)[t[t.length-1]]=r,e}static toPath(e){return e.replace(/\[(\d+)\]/g,".$1").split(".").filter(Boolean)}static unescape(e){let t={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"};return e.replace(/&amp;|&lt;|&gt;|&quot;|&#39;/g,r=>t[r])}static unset(e={},t=""){return!Array.isArray(t)&&(t=E.toPath(t)),t.reduce((r,n,p)=>p===t.length-1?(delete r[n],!0):Object(r)[n],e)}}let P={100:"Continue",101:"Switching Protocols",102:"Processing",103:"Early Hints",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",207:"Multi-Status",208:"Already Reported",226:"IM Used",300:"Multiple Choices",301:"Moved Permanently",302:"Found",304:"Not Modified",307:"Temporary Redirect",308:"Permanent Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Content Too Large",414:"URI Too Long",415:"Unsupported Media Type",416:"Range Not Satisfiable",417:"Expectation Failed",418:"I'm a teapot",421:"Misdirected Request",422:"Unprocessable Entity",423:"Locked",424:"Failed Dependency",425:"Too Early",426:"Upgrade Required",428:"Precondition Required",429:"Too Many Requests",431:"Request Header Fields Too Large",451:"Unavailable For Legal Reasons",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout",505:"HTTP Version Not Supported",506:"Variant Also Negotiates",507:"Insufficient Storage",508:"Loop Detected",510:"Not Extended",511:"Network Authentication Required"};function B(a={}){switch(A){case"Surge":a.policy&&E.set(a,"headers.X-Surge-Policy",a.policy),f.log("\u{1F6A9} \u6267\u884C\u7ED3\u675F!",`\u{1F55B} ${new Date().getTime()/1e3-$script.startTime} \u79D2`),$done(a);break;case"Loon":a.policy&&(a.node=a.policy),f.log("\u{1F6A9} \u6267\u884C\u7ED3\u675F!",`\u{1F55B} ${(new Date-$script.startTime)/1e3} \u79D2`),$done(a);break;case"Stash":a.policy&&E.set(a,"headers.X-Stash-Selected-Proxy",encodeURI(a.policy)),f.log("\u{1F6A9} \u6267\u884C\u7ED3\u675F!",`\u{1F55B} ${(new Date-$script.startTime)/1e3} \u79D2`),$done(a);break;case"Egern":case"Shadowrocket":f.log("\u{1F6A9} \u6267\u884C\u7ED3\u675F!"),$done(a);break;case"Quantumult X":switch(a.policy&&E.set(a,"opts.policy",a.policy),typeof(a=E.pick(a,["status","url","headers","body","bodyBytes"])).status){case"number":a.status=`HTTP/1.1 ${a.status} ${P[a.status]}`;break;case"string":case"undefined":break;default:throw TypeError(`${Function.name}: \u53C2\u6570\u7C7B\u578B\u9519\u8BEF, status \u5FC5\u987B\u4E3A\u6570\u5B57\u6216\u5B57\u7B26\u4E32`)}a.body instanceof ArrayBuffer?(a.bodyBytes=a.body,a.body=void 0):ArrayBuffer.isView(a.body)?(a.bodyBytes=a.body.buffer.slice(a.body.byteOffset,a.body.byteLength+a.body.byteOffset),a.body=void 0):a.body&&(a.bodyBytes=void 0),f.log("\u{1F6A9} \u6267\u884C\u7ED3\u675F!"),$done(a);break;default:f.log("\u{1F6A9} \u6267\u884C\u7ED3\u675F!"),process.exit(1)}}let N=a=>{let e={};switch(typeof a){case void 0:break;case"string":case"number":case"boolean":switch($app){case"Surge":case"Stash":case"Egern":default:e.url=a;break;case"Loon":case"Shadowrocket":e.openUrl=a;break;case"Quantumult X":e["open-url"]=a;case"Node.js":}break;case"object":{let t=a.open||a["open-url"]||a.url||a.openUrl,r=a.copy||a["update-pasteboard"]||a.updatePasteboard,n=a.media||a["media-url"]||a.mediaUrl;switch($app){case"Surge":case"Stash":case"Egern":case"Shadowrocket":default:if(t&&(e.action="open-url",e.url=t),r&&(e.action="clipboard",e.text=r),n)switch(!0){case n.startsWith("http"):e["media-url"]=n;break;case n.startsWith("data:"):{let{MIME:p,Base64:y}=n.match(/^data:(?<MIME>\w+\/\w+);base64,(?<Base64>.+)/).groups;e["media-base64"]=y,e["media-base64-mime"]=a.mime||p;break}default:switch(e["media-base64"]=n,!0){case n.startsWith("CiVQREYt"):case n.startsWith("JVBERi0"):e["media-base64-mime"]="application/pdf";break;case n.startsWith("R0lGODdh"):case n.startsWith("R0lGODlh"):e["media-base64-mime"]="image/gif";break;case n.startsWith("iVBORw0KGgo"):e["media-base64-mime"]="image/png";break;case n.startsWith("/9j/"):e["media-base64-mime"]="image/jpg";break;case n.startsWith("Qk02U"):e["media-base64-mime"]="image/bmp"}}a["auto-dismiss"]&&(e["auto-dismiss"]=a["auto-dismiss"]),a.sound&&(e.sound=a.sound);break;case"Loon":t&&(e.openUrl=t),n?.startsWith("http")&&(e.mediaUrl=n);break;case"Quantumult X":t&&(e["open-url"]=t),n?.startsWith("http")&&(e["media-url"]=n),r&&(e["update-pasteboard"]=r);case"Node.js":}break}default:Console.error(`\u4E0D\u652F\u6301\u7684\u901A\u77E5\u53C2\u6570\u7C7B\u578B: ${typeof a}`,"")}return e};class v{static data=null;static dataFile="box.dat";static#e=/^@(?<key>[^.]+)(?:\.(?<path>.*))?$/;static getItem(e,t=null){let r=t;if(e.startsWith("@")===!0){let{key:n,path:p}=e.match(v.#e)?.groups;e=n;let y=v.getItem(e,{});typeof y!="object"&&(y={}),r=E.get(y,p);try{r=JSON.parse(r)}catch{}}else{switch(A){case"Surge":case"Loon":case"Stash":case"Egern":case"Shadowrocket":r=$persistentStore.read(e);break;case"Quantumult X":r=$prefs.valueForKey(e);break;case"Node.js":v.data=v.#s(v.dataFile),r=v.data?.[e];break;default:r=v.data?.[e]||null}try{r=JSON.parse(r)}catch{}}return r??t}static setItem(e=new String,t=new String){let r=!1;if(typeof t=="object"?t=JSON.stringify(t):t=String(t),e.startsWith("@")===!0){let{key:n,path:p}=e.match(v.#e)?.groups;e=n;let y=v.getItem(e,{});typeof y!="object"&&(y={}),E.set(y,p,t),r=v.setItem(e,y)}else switch(A){case"Surge":case"Loon":case"Stash":case"Egern":case"Shadowrocket":r=$persistentStore.write(t,e);break;case"Quantumult X":r=$prefs.setValueForKey(t,e);break;case"Node.js":v.data=v.#s(v.dataFile),v.data[e]=t,v.#a(v.dataFile),r=!0;break;default:r=v.data?.[e]||null}return r}static removeItem(e){let t=!1;if(e.startsWith("@")===!0){let{key:r,path:n}=e.match(v.#e)?.groups;e=r;let p=v.getItem(e);typeof p!="object"&&(p={}),keyValue=E.unset(p,n),t=v.setItem(e,p)}else switch(A){case"Surge":case"Loon":case"Stash":case"Egern":case"Shadowrocket":case"Node.js":t=!1;break;case"Quantumult X":t=$prefs.removeValueForKey(e);break;default:t=!1}return t}static clear(){let e=!1;switch(A){case"Surge":case"Loon":case"Stash":case"Egern":case"Shadowrocket":case"Node.js":e=!1;break;case"Quantumult X":e=$prefs.removeAllValues();break;default:e=!1}return e}static#s=e=>{if(A!=="Node.js")return{};{this.fs=this.fs?this.fs:require("node:fs"),this.path=this.path?this.path:require("node:path");let t=this.path.resolve(e),r=this.path.resolve(process.cwd(),e),n=this.fs.existsSync(t),p=!n&&this.fs.existsSync(r);if(!n&&!p)return{};try{return JSON.parse(this.fs.readFileSync(n?t:r))}catch{return{}}}};static#a=(e=this.dataFile)=>{if(A==="Node.js"){this.fs=this.fs?this.fs:require("node:fs"),this.path=this.path?this.path:require("node:path");let t=this.path.resolve(e),r=this.path.resolve(process.cwd(),e),n=this.fs.existsSync(t),p=!n&&this.fs.existsSync(r),y=JSON.stringify(this.data);n?this.fs.writeFileSync(t,y):p?this.fs.writeFileSync(r,y):this.fs.writeFileSync(t,y)}}}function D(a){return/^\d+$/.test(a)&&(a=Number.parseInt(a,10)),a}let O={ADBlock:{Settings:{Splash:!0,Feed:{AD:!0,Activity:!1,Vertical:!1,BlockUpLiveList:"",Story:!0},Search:{AD:!0,HotSearch:!0},PGC:{AD:!0},Xlive:{AD:!0},Dynamic:{HotTopics:!0,MostVisited:!1,AdCard:!0},View:{AD:!0},DM:{Command:!1,Colorful:!1},Reply:{AD:!0}}},Default:{Settings:{LogLevel:"WARN"}}};var F=L("214");let i=new URL($request.url);f.info(`url: ${i.toJSON()}`);let T=i.pathname.split("/").filter(Boolean);f.info(`PATHs: ${T}`);let k=($request.headers?.["Content-Type"]??$request.headers?.["content-type"])?.split(";")?.[0];f.info(`FORMAT: ${k}`),(async()=>{let{Settings:a,Caches:e,Configs:t}=(function(r,n,p){f.log("\u2611\uFE0F Set Environment Variables");let{Settings:y,Caches:s,Configs:d}=(function(g,h,w){h=[h].flat(Number.POSITIVE_INFINITY);let b={Settings:w?.Default?.Settings||{},Configs:w?.Default?.Configs||{},Caches:{}};switch(h.forEach(m=>{b.Settings={...b.Settings,...w?.[m]?.Settings},b.Configs={...b.Configs,...w?.[m]?.Configs}}),typeof $argument){case"string":$argument=Object.fromEntries($argument.split("&").map(m=>m.split("=",2).map(S=>S.replace(/\"/g,""))));case"object":{let m={};Object.keys($argument).forEach(S=>E.set(m,S,$argument[S])),b.Settings={...b.Settings,...m}}}let x=v.getItem(g);return x&&h.forEach(m=>{switch(typeof x?.[m]?.Settings){case"string":x[m].Settings=JSON.parse(x[m].Settings||"{}");case"object":b.Settings={...b.Settings,...x[m].Settings}}switch(typeof x?.[m]?.Caches){case"string":x[m].Caches=JSON.parse(x[m].Caches||"{}");case"object":b.Caches={...b.Caches,...x[m].Caches}}}),(function m(S,C){for(let j in S){let R=S[j];S[j]=typeof R=="object"&&R!==null?m(R,C):C(j,R)}return S})(b.Settings,(m,S)=>(S==="true"||S==="false"?S=JSON.parse(S):typeof S=="string"&&(S=S.includes(",")?S.split(",").map(C=>D(C)):D(S)),S)),b})(r,n,p);return f.info(`typeof Settings: ${typeof y}`,`Settings: ${JSON.stringify(y,null,2)}`),f.log("\u2705 Set Environment Variables"),{Settings:y,Caches:s,Configs:d}})("BiliBili","ADBlock",O);switch(f.logLevel=a.LogLevel,$request.method){case"POST":case"PUT":case"PATCH":case"DELETE":case"GET":case"HEAD":case"OPTIONS":default:switch(i.hostname){case"www.bilibili.com":case"search.bilibili.com":break;case"app.bilibili.com":case"app.biliapi.net":switch(i.pathname){case"/x/v2/splash/show":case"/x/v2/splash/list":case"/x/v2/splash/brand/list":case"/x/v2/splash/event/list2":case"/x/v2/feed/index/story":case"/x/v2/search/square":case"/x/v2/search":case"/x/v2/search/type":break;case"/x/v2/feed/index":switch(a?.Feed?.Activity){case!0:default:if(i.searchParams.has("banner_hash")&&i.searchParams.get("login_event")!=="0"){i.searchParams.delete("sign"),i.searchParams.set("open_event",""),i.searchParams.set("pull",0),e.banner_hash&&(i.searchParams.set("banner_hash",e.banner_hash),f.log("\u2705 \u8BFB\u53D6hash\u7F13\u5B58\u6210\u529F"));let r=F(`${i.search.substring(1)}c2ed53a74eeefe3cf99fbd01d8c9c375`).toString();i.searchParams.set("sign",r)}break;case!1:f.warn("\u7528\u6237\u8BBE\u7F6E\u63A8\u8350\u9875\u6D3B\u52A8\u5927\u56FE\u4E0D\u53BB\u9664")}}break;case"api.bilibili.com":case"api.biliapi.net":i.pathname;break;case"api.live.bilibili.com":i.pathname}case"CONNECT":case"TRACE":}$request.url=i.toString(),f.debug(`$request.url: ${$request.url}`)})().catch(a=>f.error(a)).finally(()=>{switch(typeof $){case"object":$.headers?.["Content-Encoding"]&&($.headers["Content-Encoding"]="identity"),$.headers?.["content-encoding"]&&($.headers["content-encoding"]="identity"),A==="Quantumult X"?(!$.status&&($.status="HTTP/1.1 200 OK"),delete $.headers?.["Content-Length"],delete $.headers?.["content-length"],delete $.headers?.["Transfer-Encoding"],B($)):B({response:$});break;case"undefined":B($request);break;default:f.error(`\u4E0D\u5408\u6CD5\u7684 $response \u7C7B\u578B: ${typeof $}`)}})})()})();
