// Wed Jun 04 2025 21:17:52 GMT+0000 (Coordinated Universal Time) https://raw.githubusercontent.com/ElementRef/AboutConfig/main/script/zheye.zhihu.js
const scriptName="\u54F2\u4E5F\u540C\u5B66",blockedUsersKey="zhihu_blocked_users",currentUserInfoKey="zhihu_current_userinfo",keywordBlockKey="zhihu_keyword_block",blackAnswersIdKey="zhihu_black_answers",userCreditScoreKey="zhihu_credit_score",zheyeServerKey="zheye_server_url",defaultAnswerBlockedUsers=["\u4F1A\u5458\u63A8\u8350","\u76D0\u9009\u63A8\u8350"];const $=MagicJS(scriptName,"INFO");function getUserInfo(){let t={id:"default",is_vip:!1};try{let e=$.data.read(currentUserInfoKey);return typeof e=="string"&&(e=JSON.parse(e)),e&&e.hasOwnProperty("id")?e:t}catch(e){return $.logger.error(`\u83B7\u53D6\u7528\u6237\u4FE1\u606F\u51FA\u73B0\u5F02\u5E38\uFF1A${e}`),t}}function modifyAppConfig(){let t=null;try{if($.response.body){let e=JSON.parse($.response.body);e.config.homepage_feed_tab.tab_infos=e.config.homepage_feed_tab.tab_infos.filter(i=>i.tab_type==="activity_tab"?(i.end_time=(new Date-12e4).toString().slice(0,10),!0):!1),e.config.zvideo_max_number=1,e.config.is_show_followguide_alert=!1,delete e.config.hp_channel_tab,e.config.zombie_conf&&(e.config.zombie_conf.zombieEnable=!1),e.config.gray_mode&&(e.config.gray_mode.enable=!1,e.config.gray_mode.start_time="4092566400",e.config.gray_mode.end_time="4092566400"),e.config.hasOwnProperty("zhcnh_thread_sync")&&($.logger.debug(JSON.stringify(e.config.zhcnh_thread_sync)),e.config.zhcnh_thread_sync.LocalDNSSetHostWhiteList=[],e.config.zhcnh_thread_sync.isOpenLocalDNS="0",e.config.zhcnh_thread_sync.ZHBackUpIP_Switch_Open="0",e.config.zhcnh_thread_sync.dns_ip_detector_operation_lock="1",e.config.zhcnh_thread_sync.ZHHTTPSessionManager_setupZHHTTPHeaderField="1"),t={body:JSON.stringify(e)}}}catch(e){$.logger.error(`\u4F18\u5316\u8F6F\u4EF6\u914D\u7F6E\u51FA\u73B0\u5F02\u5E38\uFF1A${e}`)}return t}function modifyAppTabConfig(){let t=null;try{if($.response.body){let e=JSON.parse($.response.body);if(e.more_sections){let i=$.data.read("zheye_remove_feed_tabs","").split(";");e.selected_sections=e.selected_sections.filter(s=>!i.includes(s.section_name)),e.selected_sections.forEach(s=>{s.show_type="adjustable"})}$.logger.debug(JSON.stringify(e)),t={body:JSON.stringify(e)}}}catch(e){$.logger.error(`\u4F18\u5316\u8F6F\u4EF6\u914D\u7F6E\u51FA\u73B0\u5F02\u5E38\uFF1A${e}`)}return t}function modifyMCloudConfig(){let t=null;try{if($.response.body){let e=JSON.parse($.response.body);e.data&&e.data.configs&&e.data.configs.forEach(s=>{s.configKey==="feed_gray_theme"&&(s.configValue.start_time="1669824000",s.configValue.end_time="1669824001",s.status=!1)});const i=JSON.stringify(e);$.logger.debug(i),t={body:i}}}catch(e){$.logger.error(`\u4F18\u5316\u8F6F\u4EF6\u914D\u7F6E\u51FA\u73B0\u5F02\u5E38\uFF1A${e}`)}return t}function unlockBlockedKeywords(){let t=null;try{const e=getUserInfo();if($.request.method==="GET"){let i=$.data.read(keywordBlockKey,null,e.id);i||(i=[]);let s={"Cache-Control":"no-cache, no-store, must-revalidate, private, max-age=0",Connection:"keep-alive","Content-Type":"application/json;charset=utf-8",Pragma:"no-cache","Referrer-Policy":"no-referrer-when-downgrade",Server:"CLOUD ELB 1.0.0",Vary:"Accept-Encoding","X-Cache-Lookup":"Cache Miss","x-cdn-provider":"tencent"},o=JSON.stringify({success:!0,is_vip:!0,kw_min_length:2,kw_max_length:100,kw_max_count:1e3,data:i});$.env.isQuanX?t={body:o,headers:s,status:"HTTP/1.1 200 OK"}:t={response:{body:o,headers:s,status:200}},$.logger.debug(`\u83B7\u53D6\u672C\u5730\u811A\u672C\u5C4F\u853D\u5173\u952E\u8BCD\uFF1A
${i.join("\u3001")}`)}else if($.request.method==="POST"){if($.request.body){let i={"Cache-Control":"no-cache, no-store, must-revalidate, private, max-age=0",Connection:"keep-alive","Content-Type":"application/json;charset=utf-8",Pragma:"no-cache","Referrer-Policy":"no-referrer-when-downgrade",Server:"CLOUD ELB 1.0.0",Vary:"Accept-Encoding","X-Cache-Lookup":"Cache Miss","x-cdn-provider":"tencent"},s=decodeURIComponent($.request.body).match(/keyword=(.*)/)[1],o=$.data.read(keywordBlockKey,null,e.id);o||(o=[]);let d=!1;for(let c=0;c<o.length;c++)if(s===o[c]){d=!0;break}if(d===!1){o.push(s),$.data.write(keywordBlockKey,o,e.id);let c=JSON.stringify({success:!0});$.env.isQuanX?t={body:c,headers:i,status:"HTTP/1.1 200 OK"}:t={response:{body:c,headers:i,status:200}},$.logger.debug(`\u6DFB\u52A0\u672C\u5730\u811A\u672C\u5C4F\u853D\u5173\u952E\u8BCD\u201C${s}\u201D`)}else{let c=JSON.stringify({error:{message:"\u5173\u952E\u8BCD\u5DF2\u5B58\u5728",code:100002}});$.env.isQuanX?t={body:c,headers:i,status:"HTTP/1.1 400 Bad Request"}:t={response:{body:c,headers:i,status:400}}}}}else if($.request.method==="DELETE"){let i=decodeURIComponent($.request.url).match(/keyword=(.*)/)[1],s=$.data.read(keywordBlockKey,null,e.id);s||(s=[]),s=s.filter(c=>c!==i),$.data.write(keywordBlockKey,s,e.id);let o={"Cache-Control":"no-cache, no-store, must-revalidate, private, max-age=0",Connection:"keep-alive","Content-Type":"application/json;charset=utf-8",Pragma:"no-cache","Referrer-Policy":"no-referrer-when-downgrade",Server:"CLOUD ELB 1.0.0",Vary:"Accept-Encoding","X-Cache-Lookup":"Cache Miss","x-cdn-provider":"tencent"},d=JSON.stringify({success:!0});$.env.isQuanX?t={body:d,headers:o,status:"HTTP/1.1 200 OK"}:t={response:{body:d,headers:o,status:200}},$.logger.debug(`\u5220\u9664\u672C\u5730\u811A\u672C\u5C4F\u853D\u5173\u952E\u8BCD\uFF1A\u201C${i}\u201D`)}}catch(e){$.logger.debug(`\u5173\u952E\u8BCD\u5C4F\u853D\u64CD\u4F5C\u51FA\u73B0\u5F02\u5E38\uFF1A${e}`)}return t}function processUserInfo(){let t=null;try{let e=JSON.parse($.response.body);if($.data.write(blackAnswersIdKey,[]),$.logger.debug(`\u7528\u6237\u767B\u5F55\u7528\u6237\u4FE1\u606F\uFF0C\u63A5\u53E3\u54CD\u5E94\uFF1A${$.response.body}`),e&&e.id&&e.hasOwnProperty("vip_info")&&e.vip_info.hasOwnProperty("is_vip")){const i={id:e.id,is_vip:e.vip_info.is_vip?e.vip_info.is_vip!==void 0:!1};$.logger.debug(`\u5F53\u524D\u7528\u6237id\uFF1A${e.id}\uFF0C\u662F\u5426\u4E3AVIP\uFF1A${e.vip_info.is_vip}`),$.data.write(currentUserInfoKey,i),$.data.read("zhihu_settings_fake_vip")!==!1&&e.vip_info.is_vip===!1&&(e.vip_info.is_vip=!0,e.vip_info.vip_type=2,e.vip_info.vip_icon={url:"https://picx.zhimg.com/v2-aa8a1823abfc46f14136f01d55224925.jpg?source=88ceefae",night_mode_url:"https://picx.zhimg.com/v2-aa8a1823abfc46f14136f01d55224925.jpg?source=88ceefae"},e.vip_info.vip_icon_v2={url:"https://picx.zhimg.com/v2-aa8a1823abfc46f14136f01d55224925.jpg?source=88ceefae",night_mode_url:"https://picx.zhimg.com/v2-aa8a1823abfc46f14136f01d55224925.jpg?source=88ceefae"},e.vip_info.entrance={icon:{url:"https://pic3.zhimg.com/v2-5b7012c8c22fd520f5677305e1e551bf.png",night_mode_url:"https://pic4.zhimg.com/v2-e51e3252d7a2cb016a70879defd5da0b.png"},title:"\u76D0\u9009\u4F1A\u5458 \u4E3A\u4F60\u4E25\u9009\u597D\u5185\u5BB9",expires_day:"2099-12-31",sub_title:null,button_text:"\u9996\u6708 9 \u5143",jump_url:"zhihu://vip/purchase",button_jump_url:"zhihu://vip/purchase",sub_title_new:null,identity:"super_svip"},e.vip_info.entrance_new={left_button:{title:"\u7CBE\u9009\u4F1A\u5458\u5185\u5BB9",description:"\u4E3A\u60A8\u4E25\u9009\u597D\u5185\u5BB9",jump_url:"zhihu://market/home"},right_button:{title:"\u5F00\u901A\u76D0\u9009\u4F1A\u5458",description:"\u7545\u4EAB 10w+ \u573A\u4F18\u8D28\u5185\u5BB9\u7B49\u7279\u6743",jump_url:"zhihu://vip/purchase"}},e.vip_info.entrance_v2={title:"\u6211\u7684\u8D85\u7EA7\u76D0\u9009\u4F1A\u5458",sub_title:"\u7545\u4EAB 5000W+ \u4F18\u8D28\u5185\u5BB9",jump_url:"zhihu://market/home",button_text:"\u67E5\u770B\u4F1A\u5458",sub_title_color:"#F8E2C4",sub_title_list:["\u7545\u4EAB 5000W+ \u4F18\u8D28\u5185\u5BB9"],card_jump_url:"zhihu://market/home"},$.logger.debug("\u8BBE\u7F6E\u7528\u6237\u4E3A\u672C\u5730\u76D0\u9009\u4F1A\u5458"),t={body:JSON.stringify(e)})}else $.logger.warning("\u6CA1\u6709\u83B7\u53D6\u5230\u672C\u6B21\u767B\u5F55\u7528\u6237\u4FE1\u606F\uFF0C\u5982\u672A\u5BF9\u529F\u80FD\u9020\u6210\u5F71\u54CD\uFF0C\u8BF7\u5FFD\u7565\u6B64\u65E5\u5FD7\u3002")}catch(e){$.logger.error(`\u83B7\u53D6\u5F53\u524D\u7528\u6237\u4FE1\u606F\u51FA\u73B0\u5F02\u5E38\uFF1A${e}`)}return t}function manageBlackUser(){const t=getUserInfo();let e={},i=$.data.read(blockedUsersKey,"",t.id);if(i=typeof i=="object"&&i?i:{},defaultAnswerBlockedUsers.forEach(s=>{i[s]="00000000000000000000000000000000",e[s]="00000000000000000000000000000000"}),$.logger.debug(`\u5F53\u524D\u7528\u6237id\uFF1A${t.id}\uFF0C\u811A\u672C\u9ED1\u540D\u5355\uFF1A${JSON.stringify(i)}`),$.request.method==="GET")try{$.request.url.indexOf("offset")<0&&(i=e,$.logger.debug("\u811A\u672C\u9ED1\u540D\u5355\u5DF2\u6E05\u7A7A\uFF0C\u8BF7\u6ED1\u52A8\u81F3\u9ED1\u540D\u5355\u672B\u5C3E\u4FDD\u8BC1\u91CD\u65B0\u83B7\u53D6\u5B8C\u6210\u3002"),$.notification.post("\u5F00\u59CB\u540C\u6B65\u9ED1\u540D\u5355\u6570\u636E\uFF0C\u8BF7\u6ED1\u52A8\u81F3\u9ED1\u540D\u5355\u672B\u5C3E\uFF0C\u76F4\u81F3\u5F39\u51FA\u201C\u540C\u6B65\u6210\u529F\u201D\u7684\u901A\u77E5\u3002"));let s=JSON.parse($.response.body);s.data?($.logger.debug(`\u672C\u6B21\u6ED1\u52A8\u83B7\u53D6\u7684\u9ED1\u540D\u5355\u4FE1\u606F\uFF1A${JSON.stringify(s.data)}`),s.data.forEach(o=>{o.name!=="[\u5DF2\u91CD\u7F6E]"&&(i[o.name]=o.id)}),$.data.write(blockedUsersKey,i,t.id),s.paging.is_end===!0&&($.notification.post(`\u540C\u6B65\u9ED1\u540D\u5355\u6570\u636E\u6210\u529F\uFF01\u5F53\u524D\u9ED1\u540D\u5355\u5171${Object.keys(i).length-defaultAnswerBlockedUsers.length}\u4EBA\u3002
\u811A\u672C\u5185\u7F6E\u9ED1\u540D\u5355${defaultAnswerBlockedUsers.length}\u4EBA\u3002`),$.logger.debug(`\u811A\u672C\u9ED1\u540D\u5355\u5185\u5BB9\uFF1A${JSON.stringify(i)}\u3002`))):$.logger.warning(`\u83B7\u53D6\u9ED1\u540D\u5355\u5931\u8D25\uFF0C\u63A5\u53E3\u54CD\u5E94\u4E0D\u5408\u6CD5\uFF1A${$.response.body}`)}catch(s){$.data.del(blockedUsersKey),$.logger.error(`\u83B7\u53D6\u9ED1\u540D\u5355\u5931\u8D25\uFF0C\u5F02\u5E38\u4FE1\u606F\uFF1A${s}`),$.notification.post("\u83B7\u53D6\u9ED1\u540D\u5355\u5931\u8D25\uFF0C\u6267\u884C\u5F02\u5E38\uFF0C\u5DF2\u6E05\u7A7A\u9ED1\u540D\u5355\u3002")}else if($.request.method==="POST")try{let s=JSON.parse($.response.body);s.hasOwnProperty("name")&&s.hasOwnProperty("id")?($.logger.debug(`\u5F53\u524D\u9700\u8981\u52A0\u5165\u9ED1\u540D\u5355\u7684\u7528\u6237Id\uFF1A${s.id}\uFF0C\u7528\u6237\u540D\uFF1A${s.name}`),s.id?(i[s.name]=s.id,$.data.write(blockedUsersKey,i,t.id),$.logger.debug(`${s.name}\u5199\u5165\u811A\u672C\u9ED1\u540D\u5355\u6210\u529F\uFF0C\u5F53\u524D\u811A\u672C\u9ED1\u540D\u5355\u6570\u636E\uFF1A${JSON.stringify(i)}`),$.notification.post(`\u5DF2\u5C06\u7528\u6237\u201C${s.name}\u201D\u5199\u5165\u811A\u672C\u9ED1\u540D\u5355\u3002`)):($.logger.error(`${s.name}\u5199\u5165\u811A\u672C\u9ED1\u540D\u5355\u5931\u8D25\uFF0C\u6CA1\u6709\u83B7\u53D6\u5230\u7528\u6237Id\u3002`),$.notification.post(`\u5C06\u7528\u6237\u201C${s.name}\u201D\u5199\u5165\u811A\u672C\u9ED1\u540D\u5355\u5931\u8D25\uFF01`))):($.logger.warning(`\u5199\u5165\u9ED1\u540D\u5355\u5931\u8D25\uFF0C\u63A5\u53E3\u54CD\u5E94\u4E0D\u5408\u6CD5\uFF1A${$.response.body}`),$.notification.post("\u5199\u5165\u811A\u672C\u9ED1\u540D\u5355\u5931\u8D25\uFF0C\u63A5\u53E3\u8FD4\u56DE\u4E0D\u5408\u6CD5\u3002"))}catch(s){$.logger.error(`\u5199\u5165\u9ED1\u540D\u5355\u5931\u8D25\uFF0C\u5F02\u5E38\u4FE1\u606F\uFF1A${s}`),$.notification.post("\u5199\u5165\u811A\u672C\u9ED1\u540D\u5355\u5931\u8D25\uFF0C\u6267\u884C\u5F02\u5E38\uFF0C\u8BF7\u67E5\u9605\u65E5\u5FD7\u3002")}else if($.request.method==="DELETE")try{if(JSON.parse($.response.body).success){let o=$.request.url.match(/^https?:\/\/api\.zhihu\.com\/settings\/blocked_users\/([0-9a-zA-Z]*)/)[1];if(o){$.logger.debug(`\u5F53\u524D\u9700\u8981\u79FB\u51FA\u9ED1\u540D\u5355\u7684\u7528\u6237Id\uFF1A${o}`);for(let d in i)if(i[d]===o){delete i[d],$.data.write(blockedUsersKey,i,t.id),$.logger.debug(`${d}\u79FB\u51FA\u811A\u672C\u9ED1\u540D\u5355\u6210\u529F\uFF0C\u5F53\u524D\u811A\u672C\u9ED1\u540D\u5355\u6570\u636E\uFF1A${JSON.stringify(i)}`),$.notification.post(`\u5DF2\u5C06\u7528\u6237\u201C${d}\u201D\u79FB\u51FA\u811A\u672C\u9ED1\u540D\u5355\uFF01`);break}}else $.logger.error(`\u5C06\u7528\u6237\u79FB\u51FA\u811A\u672C\u9ED1\u540D\u5355\u5931\u8D25\uFF01
\u5EFA\u8BAE\u4ECE\u8BBE\u7F6E\u4E2D\u5237\u65B0\u9ED1\u540D\u5355\u6570\u636E\u3002`),$.notification.post(`\u5C06\u7528\u6237\u79FB\u51FA\u811A\u672C\u9ED1\u540D\u5355\u5931\u8D25\uFF0C\u6CA1\u6709\u83B7\u53D6\u5230\u7528\u6237Id\u3002
\u5EFA\u8BAE\u4ECE\u8BBE\u7F6E\u4E2D\u5237\u65B0\u9ED1\u540D\u5355\u6570\u636E\u3002`)}else $.logger.warning(`\u79FB\u51FA\u9ED1\u540D\u5355\u5931\u8D25\uFF0C\u63A5\u53E3\u54CD\u5E94\u4E0D\u5408\u6CD5\uFF1A${$.response.body}`),$.notification.post("\u79FB\u51FA\u811A\u672C\u9ED1\u540D\u5355\u5931\u8D25\uFF0C\u63A5\u53E3\u8FD4\u56DE\u4E0D\u5408\u6CD5\u3002")}catch(s){$.logger.error(`\u79FB\u51FA\u9ED1\u540D\u5355\u5931\u8D25\uFF0C\u5F02\u5E38\u4FE1\u606F\uFF1A${s}`),$.notification.post("\u79FB\u51FA\u811A\u672C\u9ED1\u540D\u5355\u5931\u8D25\uFF0C\u6267\u884C\u5F02\u5E38\uFF0C\u8BF7\u67E5\u9605\u65E5\u5FD7\u3002")}}function autoInsertBlackList(){let t=null;try{let e=JSON.parse($.response.body);if(delete e.mcn_user_info,t={body:JSON.stringify(e)},e.name&&e.id&&e.is_blocking===!0){const i=getUserInfo();let s=$.data.read(blockedUsersKey,"",i.id);s=typeof s=="object"&&s?s:{},s[e.name]||($.logger.debug(`\u5F53\u524D\u9700\u8981\u52A0\u5165\u9ED1\u540D\u5355\u7684\u7528\u6237Id\uFF1A${e.id}\uFF0C\u7528\u6237\u540D\uFF1A${e.name}`),s[e.name]=e.id,$.data.write(blockedUsersKey,s,i.id),$.logger.debug(`${e.name}\u5199\u5165\u811A\u672C\u9ED1\u540D\u5355\u6210\u529F\uFF0C\u5F53\u524D\u811A\u672C\u9ED1\u540D\u5355\u6570\u636E\uFF1A${JSON.stringify(s)}`),$.notification.post(`\u5DF2\u81EA\u52A8\u5C06\u7528\u6237\u201C${e.name}\u201D\u5199\u5165\u811A\u672C\u9ED1\u540D\u5355\u3002`))}}catch(e){$.logger.error(`\u53BB\u9664MCN\u4FE1\u606F\u51FA\u73B0\u5F02\u5E38\uFF1A${e}`)}return t}function removeMoments(){let t=null;try{let e=JSON.parse($.response.body.replace(/(\w+"+\s?):\s?(\d{15,})/g,'$1:"$2"'));const i=getUserInfo();let s=$.data.read(blockedUsersKey,"",i.id);s=s||{};let o;const d=$.data.read("zhihu_settings_moments_stream",!1),c=$.data.read("zhihu_settings_moments_recommend",!1),p=$.data.read("zhihu_settings_moments_activity",!1),g=$.data.read("zhihu_settings_blocked_users",!1);o=e.data.filter(h=>{const _=g&&h.target&&h.target.origin_pin&&h.target.origin_pin.author&&typeof s[h.target.origin_pin.author.name]<"u",f=d&&h.target_type==="zvideo",b=c&&h.type==="recommend_user_card_list",O=p&&h.type==="message_activity_card";return!(_||f||b||O)}),e.data=o,t={body:JSON.stringify(e)}}catch(e){$.logger.error(`\u5173\u6CE8\u5217\u8868\u53BB\u5E7F\u544A\u51FA\u73B0\u5F02\u5E38\uFF1A${e}`)}return t}function _setRecommendTag(t,e,i="GBK02A"){t.common_card.footline||(t.common_card.footline={elements:[]}),t.common_card.footline.elements.unshift({tag:{text:e,color:i,type:"MASK_ROUNDED_RECTANGLE"}})}async function _checkPaidContentByCloud(t,e){const i=$.data.read(zheyeServerKey);if(!i)$.notification.post(`\u672A\u8BBE\u7F6E\u670D\u52A1\u7AEF\u5730\u5740\uFF0C\u65E0\u6CD5\u8FDB\u884C\u4ED8\u8D39/\u63A8\u5E7F\u5185\u5BB9\u63A2\u6D4B\u3002
\u8BF7\u914D\u7F6E\u670D\u52A1\u7AEF\u5730\u5740\uFF0C\u6216\u4F7F\u7528\u672C\u5730\u63A2\u6D4B\u3002`);else{$.logger.debug(`\u5411\u4E91\u7AEF\u8BF7\u6C42\u4EE5\u4E0B\u94FE\u63A5
${t.join(`
`)}`);const s=`${i}/api/v1/answer/links`;$.logger.debug(`\u670D\u52A1\u7AEF\u5730\u5740
${s}`),await $.http.post({url:s,headers:{"Content-Type":"application/json"},body:t}).then(o=>{$.logger.debug(`\u4E91\u7AEF\u63A2\u6D4B\u7ED3\u679C<${typeof o.body}>
${JSON.stringify(o.body)}`);for(let d=0;d<o.body.length;d++)try{let c=o.body[d];c!==""&&_setRecommendTag(e[d],c,"GBK02A")}catch(c){$.logger.error(c)}}).catch(o=>{$.logger.error(`\u4E91\u7AEF\u8BF7\u6C42\u51FA\u73B0\u5F02\u5E38
${JSON.stringify(o)}`)})}}async function _checkPaidContentByLocal(t,e){$.logger.debug(`\u5C06\u5728\u672C\u5730\u8BF7\u6C42\u4EE5\u4E0B\u94FE\u63A5
${t.join(`
`)}`);let i=[];function s(o){return new Promise(d=>{const c=t[o];!c||c===""||!c.startsWith("https://www.zhihu.com/appview/v2/answer")?d(""):$.http.get({url:t[o],timeout:1e3}).then(p=>{const g=p.body;(g.indexOf("\u67E5\u770B\u5B8C\u6574\u5185\u5BB9")>=0||g.indexOf("\u67E5\u770B\u5168\u90E8\u7AE0\u8282")>=0)&&g.indexOf("paid")>=0?d("\u4ED8\u8D39\u5185\u5BB9"):g.indexOf("ad-link-card")>=0||g.indexOf("xg.zhihu.com")>=0||g.indexOf("\u8425\u9500\u5E73\u53F0")>=0?d("\u8425\u9500\u63A8\u5E7F"):g.indexOf("mcn-link-card")>=0?d("\u8D2D\u7269\u63A8\u5E7F"):d("")}).catch(p=>{$.logger.error(`\u672C\u5730\u8BF7\u6C42\u51FA\u73B0\u5F02\u5E38
${JSON.stringify(p)}`),d("")})})}for(let o=0;o<t.length;o++)i.push(s(o));await Promise.all(i).then(o=>{$.logger.debug(`\u672C\u5730\u63A2\u6D4B\u7ED3\u679C<${o.length}>
${JSON.stringify(o)}`);for(let d=0;d<o.length;d++)try{let c=o[d];c!==""&&_setRecommendTag(e[d],c,"GBK02A")}catch(c){$.logger.error(c)}})}async function removeRecommend(){let t=null;try{const e=$.data.read("zhihu_settings_recommend_pin",!1),i=$.data.read("zhihu_settings_recommend_stream",!1),s=$.data.read("zhihu_settings_remove_article",!1),o=$.data.read("zhihu_settings_blocked_users",!1),d=$.data.read("zhihu_settings_blocked_keywords",!0),c=$.data.read("zhihu_settings_check_paid_content",!1),p=$.data.read("zhihu_settings_request_content","local"),g=getUserInfo();let h=$.data.read(keywordBlockKey,"",g.id);h=d&&h?h:[];let _=$.data.read(blockedUsersKey,"",g.id);_=o&&_?_:{};const f=y=>{const w=JSON.stringify(y),a=y.card_type==="slot_event_card"||y.card_type==="slot_video_event_card"||y.hasOwnProperty("ad")||y.brief&&y.brief.indexOf("slot_card")>=0||y.extra&&y.extra.type==="Training",u=a!==!0&&w.search(/"(type|style)+"\s?:\s?"(drama|zvideo|Video|BIG_IMAGE)+"/i)>=0,r=u&&i,l=u!==!0&&w.search(/"(type|style)+"\s?:\s?"pin"/i)>=0&&e,k=w.search(/"(type|style)+"\s?:\s?"article"/i)>=0&&s;let q=!1;if(u!==!0&&d){for(let C=0;C<h.length;C++)if(w.search(h[C])>=0){if($.isDebug){let S=y.common_card.feed_content.title.panel_text,v=y.common_card.feed_content.content.panel_text,x="";try{x=y.common_card.feed_content.title.action.intent_url}catch{}$.logger.debug(`\u5339\u914D\u5173\u952E\u5B57\uFF1A
${h[C]}
\u6807\u9898\uFF1A
${S}
\u5185\u5BB9\uFF1A
${v}`),$.notification.debug(scriptName,`\u5173\u952E\u5B57\uFF1A${h[C]}`,`${S}
${v}`,x)}q=!0;break}}let E;try{E=q!==!0&&o&&_&&y.common_card.feed_content.source_line.elements[1].text.panel_text in _}catch{E=!1}return!(a||l||k||r||q||E)};let b=JSON.parse($.response.body.replace(/(\w+"+\s?):\s?(\d{15,})/g,'$1:"$2"')),O=b.data.filter(f);if(c===!0){let y=[];for(let w=0;w<O.length;w++)if(O[w])try{let a=O[w].common_card.feed_content.title.action.intent_url;a=a.replace(/^https:\/\/zhihu\.com\/question\/\d+\/answer\//,"https://www.zhihu.com/appview/v2/answer/"),y.push(a)}catch{y.push("")}y.length>0&&p==="cloud"?await _checkPaidContentByCloud(y,O):y.length>0&&p==="local"&&await _checkPaidContentByLocal(y,O)}b.data=O,t={body:JSON.stringify(b)}}catch(e){$.logger.error(`\u63A8\u8350\u5217\u8868\u53BB\u5E7F\u544A\u51FA\u73B0\u5F02\u5E38\uFF1A${e}`)}return t}function removeQuestions(){let t=null;try{const e=getUserInfo();let i=$.data.read(blockedUsersKey,"",e.id);i=i||{};let s=JSON.parse($.response.body);const o=$.data.read("zhihu_settings_blocked_users",!1);$.logger.debug(`\u5F53\u524D\u9ED1\u540D\u5355\u5217\u8868: ${JSON.stringify(i)}`);let d=$.data.read(blackAnswersIdKey,[]);if(delete s.ad_info,s.data){let p=[];for(let g of s.data){let h="";const _=g.target.id.toString();try{"target"in g&&(h=g.target.author.name)}catch(O){$.logger.error(`\u83B7\u53D6\u56DE\u7B54\u5217\u8868\u7528\u6237\u540D\u51FA\u73B0\u5F02\u5E38\uFF1A${O}`)}const f=typeof i[h]<"u",b=o&&f;"target"in g&&(g.target.visible_only_to_author=!1,g.target.is_visible=!0,g.target.is_copyable=!0),b?b===!0&&d.includes(_)===!1&&(d.push(_),$.notification.debug(`\u8BB0\u5F55\u9ED1\u540D\u5355\u7528\u6237${h}\u7684\u56DE\u7B54Id:${_}`)):p.push(g)}s.data=p}$.data.write(blackAnswersIdKey,d);const c=JSON.stringify(s);$.logger.debug(`\u4FEE\u6539\u540E\u7684\u56DE\u7B54\u5217\u8868\u6570\u636E\uFF1A${c}`),t={body:c}}catch(e){$.logger.error(`\u56DE\u7B54\u5217\u8868\u53BB\u5E7F\u544A\u51FA\u73B0\u5F02\u5E38\uFF1A${e}`)}return t}function modifyAnswer(){let t=null;try{let e=$.response.body,i="";if((e.indexOf("\u67E5\u770B\u5B8C\u6574\u5185\u5BB9")>=0||e.indexOf("\u67E5\u770B\u5168\u90E8\u7AE0\u8282")>=0)&&e.indexOf("paid")>=0?i='<a style="height: 42px;padding: 0 12px;border-radius: 6px;background-color: rgb(247 104 104 / 8%);display: block;text-decoration: none;" href="#"><div style="color: #f36;display: flex;-webkit-box-align: center;align-items: center;height: 100%;"><svg style="width: 1.2em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024"><path d="M821.333333 138.666667c64.8 0 117.333333 52.533333 117.333334 117.333333v149.333333a32 32 0 0 1-32 32 74.666667 74.666667 0 0 0 0 149.333334 32 32 0 0 1 32 32v149.333333c0 64.8-52.533333 117.333333-117.333334 117.333333H202.666667c-64.8 0-117.333333-52.533333-117.333334-117.333333V618.666667a32 32 0 0 1 32-32 74.666667 74.666667 0 0 0 0-149.333334 32 32 0 0 1-32-32V256c0-64.8 52.533333-117.333333 117.333334-117.333333h618.666666zM428.576 329.994667a32 32 0 0 0-43.733333-2.581334l-1.514667 1.344a32 32 0 0 0-2.581333 43.733334L452.565333 458.666667H405.333333l-1.877333 0.053333A32 32 0 0 0 373.333333 490.666667l0.053334 1.877333A32 32 0 0 0 405.333333 522.666667h80v42.666666H405.333333l-1.877333 0.053334A32 32 0 0 0 373.333333 597.333333l0.053334 1.877334A32 32 0 0 0 405.333333 629.333333h80v42.666667l0.053334 1.877333A32 32 0 0 0 517.333333 704l1.877334-0.053333A32 32 0 0 0 549.333333 672v-42.666667H618.666667l1.877333-0.053333A32 32 0 0 0 650.666667 597.333333l-0.053334-1.877333A32 32 0 0 0 618.666667 565.333333h-69.333334v-42.666666H618.666667l1.877333-0.053334A32 32 0 0 0 650.666667 490.666667l-0.053334-1.877334A32 32 0 0 0 618.666667 458.666667h-47.253334l71.84-86.186667 1.248-1.589333a32 32 0 0 0-50.421333-39.381334L512 430.016l-82.08-98.506667z"></path></svg><div style="flex: 1 1;white-space: nowrap;text-overflow: ellipsis;padding-left:4px"><span style="font-family: -apple-system,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Microsoft YaHei,Source Han Sans SC,Noto Sans CJK SC,WenQuanYi Micro Hei,sans-serif;-webkit-tap-highlight-color: rgba(26,26,26,0);font-size: 14px;line-height: 20px;color: #f36;white-space: nowrap;font-weight: 600;">\u672C\u6587\u4E3A\u4ED8\u8D39\u5185\u5BB9</span></div><div></div></div></a>':e.indexOf("ad-link-card")>=0||e.indexOf("xg.zhihu.com")>=0||e.indexOf("\u8425\u9500\u5E73\u53F0")>=0?i='<a style="height: 42px;padding: 0 12px;border-radius: 6px;background-color: rgb(8 188 212 / 8%);display: block;text-decoration: none;" href="#"><div style="color: #00bcd4;display: flex;-webkit-box-align: center;align-items: center;height: 100%;"><svg style="width: 1.2em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024"><path d="M128 765.952q0 26.624 18.432 45.056t45.056 18.432l191.488 0 0 128-254.976 0q-26.624 0-49.664-10.24t-40.448-27.648-27.648-40.448-10.24-49.664l0-637.952q0-25.6 10.24-49.152t27.648-40.448 40.448-27.136 49.664-10.24l701.44 0q26.624 0 49.664 10.24t40.448 27.136 27.648 40.448 10.24 49.152l0 251.904-128 1.024 0-61.44q0-26.624-18.432-45.056t-45.056-18.432l-574.464 0q-26.624 0-45.056 18.432t-18.432 45.056l0 382.976zM990.208 705.536q21.504 18.432 22.016 34.304t-20.992 33.28q-21.504 18.432-51.2 41.472t-60.928 48.128-61.952 49.152-55.296 43.52q-26.624 20.48-43.52 15.36t-16.896-31.744q1.024-16.384 0-40.448t-1.024-41.472q0-19.456-10.752-24.064t-31.232-4.608q-21.504 0-39.936-0.512t-35.84-0.512-36.352-0.512-41.472-0.512q-9.216 0-19.968-2.048t-19.456-7.168-14.336-15.36-5.632-27.648l0-80.896q0-31.744 15.36-42.496t48.128-10.752q30.72 1.024 61.44 1.024t71.68 1.024q29.696 0 46.08-5.12t16.384-25.6q-1.024-14.336 0.512-35.328t1.536-37.376q0-26.624 14.336-33.28t36.864 10.752q22.528 18.432 52.736 43.008t61.952 50.688 62.976 51.2 54.784 44.544z"></path></svg><div style="flex: 1 1;white-space: nowrap;text-overflow: ellipsis;padding-left:4px"><span style="font-family: -apple-system,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Microsoft YaHei,Source Han Sans SC,Noto Sans CJK SC,WenQuanYi Micro Hei,sans-serif;-webkit-tap-highlight-color: rgba(26,26,26,0);font-size: 14px;line-height: 20px;color: #00bcd4;white-space: nowrap;font-weight: 600;">\u672C\u6587\u542B\u6709\u8425\u9500\u63A8\u5E7F</span></div><div></div></div></a>':e.indexOf("mcn-link-card")>=0?i='<a style="height: 42px;padding: 0 12px;border-radius: 6px;background-color: rgb(8 188 212 / 8%);display: block;text-decoration: none;" href="#"><div style="color: #00bcd4;display: flex;-webkit-box-align: center;align-items: center;height: 100%;"><svg style="width: 1.2em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024"><path d="M346.112 806.912q19.456 0 36.864 7.168t30.208 19.968 20.48 30.208 7.68 36.864-7.68 36.864-20.48 30.208-30.208 20.48-36.864 7.68q-20.48 0-37.888-7.68t-30.208-20.48-20.48-30.208-7.68-36.864 7.68-36.864 20.48-30.208 30.208-19.968 37.888-7.168zM772.096 808.96q19.456 0 37.376 7.168t30.72 19.968 20.48 30.208 7.68 36.864-7.68 36.864-20.48 30.208-30.72 20.48-37.376 7.68-36.864-7.68-30.208-20.48-20.48-30.208-7.68-36.864 7.68-36.864 20.48-30.208 30.208-19.968 36.864-7.168zM944.128 227.328q28.672 0 44.544 7.68t22.528 18.944 6.144 24.064-3.584 22.016-13.312 37.888-22.016 62.976-23.552 68.096-18.944 53.248q-13.312 40.96-33.28 56.832t-49.664 15.872l-35.84 0-65.536 0-86.016 0-96.256 0-253.952 0 14.336 92.16 517.12 0q49.152 0 49.152 41.984 0 20.48-9.728 35.328t-38.4 14.848l-49.152 0-94.208 0-118.784 0-119.808 0-99.328 0-55.296 0q-20.48 0-34.304-9.216t-23.04-24.064-14.848-32.256-8.704-32.768q-1.024-6.144-5.632-29.696t-11.264-58.88-14.848-78.848-16.384-87.552q-19.456-103.424-44.032-230.4l-76.8 0q-15.36 0-25.6-7.68t-16.896-18.432-9.216-23.04-2.56-22.528q0-20.48 13.824-33.792t37.376-13.312l21.504 0 21.504 0 25.6 0 34.816 0q20.48 0 32.768 6.144t19.456 15.36 10.24 19.456 5.12 17.408q2.048 8.192 4.096 23.04t4.096 30.208q3.072 18.432 6.144 38.912l700.416 0zM867.328 194.56l-374.784 0 135.168-135.168q23.552-23.552 51.712-24.064t51.712 23.04z"></path></svg><div style="flex: 1 1;white-space: nowrap;text-overflow: ellipsis;padding-left:4px"><span style="font-family: -apple-system,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Microsoft YaHei,Source Han Sans SC,Noto Sans CJK SC,WenQuanYi Micro Hei,sans-serif;-webkit-tap-highlight-color: rgba(26,26,26,0);font-size: 14px;line-height: 20px;color: #00bcd4;white-space: nowrap;font-weight: 600;">\u672C\u6587\u542B\u6709\u8D2D\u7269\u63A8\u5E7F</span></div><div></div></div></a>':Math.floor(Math.random()*200)===7&&(i='<a style="height: 42px;padding: 0 12px;border-radius: 6px;background-color: rgb(74 162 56 / 8%);display: block;text-decoration: none;" href="#"><div style="color: #619201;display: flex;-webkit-box-align: center;align-items: center;height: 100%;"><svg class="icon" style="width: 1.2em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024"><path d="M512 85.333333c71.477333 0 159.68 57.546667 229.258667 147.018667C817.845333 330.826667 864 455.978667 864 586.666667c0 211.808-148.501333 352-352 352S160 798.474667 160 586.666667c0-130.688 46.144-255.84 122.741333-354.314667C352.32 142.88 440.522667 85.333333 512 85.333333z m0 64c-48.213333 0-120.096 46.912-178.741333 122.314667C265.109333 359.253333 224 470.762667 224 586.666667c0 175.616 119.050667 288 288 288s288-112.384 288-288c0-115.904-41.109333-227.402667-109.258667-315.018667C632.096 196.234667 560.213333 149.333333 512 149.333333z m-74.666667 522.666667a53.333333 53.333333 0 1 1 0 106.666667 53.333333 53.333333 0 0 1 0-106.666667z m-96-128a42.666667 42.666667 0 1 1 0 85.333333 42.666667 42.666667 0 0 1 0-85.333333z"></path></svg><div style="flex: 1 1;white-space: nowrap;text-overflow: ellipsis;padding-left:4px"><span style="font-family: -apple-system,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Microsoft YaHei,Source Han Sans SC,Noto Sans CJK SC,WenQuanYi Micro Hei,sans-serif;-webkit-tap-highlight-color: rgba(26,26,26,0);font-size: 14px;line-height: 20px;color: #619201;white-space: nowrap;font-weight: 600;">\u672C\u6587\u4E3A\u514D\u8D39\u5185\u5BB9</span></div><div></div></div></a>'),i!==""){const s=e.match(/(richText[^<]*>)(.)/)[1],o=e.lastIndexOf(s)+s.length;t={body:e.slice(0,o)+i+e.slice(o)}}}catch(e){$.logger.error(`\u4ED8\u8D39\u5185\u5BB9\u63D0\u9192\u51FA\u73B0\u5F02\u5E38\uFF1A${e}`)}return t}function removeComment(){let t=null;try{if($.response.body){let e=JSON.parse($.response.body);if(e.ad_info={},$.data.read("zhihu_settings_blocked_users",!1)===!0){let s=getUserInfo(),o=$.data.read(blockedUsersKey,"",s.id);o=o||{};let d=[],c={};if(typeof e.root<"u"){const p=e.root.author.name;typeof o[p]<"u"===!0&&(e.root.is_delete=!0,e.root.can_reply=!1,e.root.can_like=!1,e.root.author.name="\u9ED1\u540D\u5355\u7528\u6237",e.root.author.avatar_url="https://picx.zhimg.com/v2-abed1a8c04700ba7d72b45195223e0ff_xll.jpg")}typeof e.data<"u"&&e.data.forEach(p=>{const g=p.author.name;let h="";p.reply_to_author&&p.reply_to_author.name&&(h=p.reply_to_author.name);const _=h!=="",f=typeof o[g]<"u",b=typeof o[h]<"u";if((f===!0||b===!0)&&(f&&!_&&$.request.url.indexOf("root_comment")>0?$.notification.debug(`\u5C4F\u853D\u9ED1\u540D\u5355\u7528\u6237\u201C${g}\u201D\u7684\u4E3B\u8BC4\u8BBA\u3002`):!f&&_&&!b&&$.request.url.indexOf("child_comment")>0?$.notification.debug(`\u5C4F\u853D\u9ED1\u540D\u5355\u7528\u6237\u201C${g}\u201D\u7684\u5B50\u8BC4\u8BBA\u3002`):f&&!b&&$.request.url.indexOf("child_comment")>0?$.notification.debug(`\u5C4F\u853D\u9ED1\u540D\u5355\u7528\u6237\u201C${g}\u201D\u56DE\u590D\u201C${h}\u201D\u7684\u5B50\u8BC4\u8BBA\u3002`):f&&b&&$.request.url.indexOf("child_comment")>0&&$.notification.debug(`\u5C4F\u853D\u9ED1\u540D\u5355\u7528\u6237\u201C${g}\u201D\u56DE\u590D\u9ED1\u540D\u5355\u7528\u6237\u201C${h}\u201D\u7684\u5B50\u8BC4\u8BBA\u3002`),c[p.id]=g,f&&(p.is_delete=!0,p.can_reply=!1,p.can_like=!1,p.author.exposed_medal={},p.author.name="[\u9ED1\u540D\u5355\u7528\u6237]",p.author.avatar_url="https://picx.zhimg.com/v2-abed1a8c04700ba7d72b45195223e0ff_xll.jpg"),b&&(p.reply_to_author.name="[\u9ED1\u540D\u5355\u7528\u6237]",p.reply_to_author.exposed_medal={},p.reply_to_author.avatar_url="https://picx.zhimg.com/v2-abed1a8c04700ba7d72b45195223e0ff_xll.jpg")),p.child_comments){let O=[];p.child_comments.forEach(y=>{const w=y.author.name,a=typeof y.reply_to_author<"u"?y.reply_to_author.name:"",u=typeof o[w]<"u",r=typeof o[a]<"u";(u||r)&&(u===!0&&($.notification.debug(`\u5C4F\u853D\u9ED1\u540D\u5355\u7528\u6237\u201C${w}\u201D\u7684\u5B50\u8BC4\u8BBA\u3002`),c[y.id]=w,y.is_delete=!0,y.can_reply=!1,y.can_like=!1,y.author.name="[\u9ED1\u540D\u5355\u7528\u6237]",y.author.exposed_medal={},y.author.avatar_url="https://picx.zhimg.com/v2-abed1a8c04700ba7d72b45195223e0ff_xll.jpg"),r===!0&&($.logger.debug(`\u4FEE\u6539\u524D\u7684\u5B50\u8BC4\u8BBA\u6570\u636E:
${JSON.stringify(y)}`),y.reply_to_author.name="[\u9ED1\u540D\u5355\u7528\u6237]",y.reply_to_author.exposed_medal={},y.reply_to_author.avatar_url="https://picx.zhimg.com/v2-abed1a8c04700ba7d72b45195223e0ff_xll.jpg",$.notification.debug(`\u9690\u85CF\u201C${w}\u201D\u56DE\u590D\u9ED1\u540D\u5355\u7528\u6237\u201C${a}\u201D\u7684\u540D\u79F0\u4E0E\u5934\u50CF\u3002`),$.logger.debug(`\u4FEE\u6539\u540E\u7684\u5B50\u8BC4\u8BBA\u6570\u636E:
${JSON.stringify(y)}`))),O.push(y)}),p.child_comments=O}d.push(p)}),e.data=d}const i=JSON.stringify(e);$.logger.debug(`\u8FC7\u6EE4\u540E\u7684\u8BC4\u8BBA\u6570\u636E\uFF1A
${i}`),t={body:i}}}catch(e){$.logger.error(`\u53BB\u9664\u8BC4\u8BBA\u5E7F\u544A\u51FA\u73B0\u5F02\u5E38\uFF1A${e}`)}return t}function removeArticleAd(){let t=null;try{if($.response.body){let e=JSON.parse($.response.body);e.ad_info={};const i=JSON.stringify(e);$.logger.debug(`\u8FC7\u6EE4\u540E\u7684\u6587\u7AE0\u6570\u636E\uFF1A
${i}`),t={body:i}}}catch(e){$.logger.error(`\u53BB\u9664\u6587\u7AE0\u5E7F\u544A\u51FA\u73B0\u5F02\u5E38\uFF1A${e}`)}return t}function removeMarketingMsg(){let t=null;try{let e=JSON.parse($.response.body),i=[];for(let s of e.data)if(s.detail_title==="\u5B98\u65B9\u5E10\u53F7\u6D88\u606F"){let o=s.unread_count;o>0?s.content.text="\u672A\u8BFB\u6D88\u606F"+o+"\u6761":s.content.text="\u5168\u90E8\u6D88\u606F\u5DF2\u8BFB",s.is_read=!0,s.unread_count=0,i.push(s)}else s.detail_title!=="\u6D3B\u52A8\u52A9\u624B"&&i.push(s);e.data=i,t={body:JSON.stringify(e)}}catch(e){$.logger.error(`\u5C4F\u853D\u5B98\u65B9\u8425\u9500\u6D88\u606F\u51FA\u73B0\u5F02\u5E38\uFF1A${e}`)}return t}function removeHotListAds(){let t=null;try{if($.response.body){let e=JSON.parse($.response.body);"data"in e&&(e.data=e.data.filter(i=>i.type==="hot_list_feed"||i.type==="hot_list_feed_video")),t={body:JSON.stringify(e)}}}catch(e){$.logger.error(`\u53BB\u9664\u70ED\u699C\u5E7F\u544A\u51FA\u73B0\u5F02\u5E38\uFF1A${e}`)}return t}function removeKeywordAds(){let t=null;try{if($.response.body){$.logger.debug(`\u9884\u7F6E\u5173\u952E\u5B57\u8FD4\u56DE\uFF1A${$.response.body}`);let e=JSON.parse($.response.body);e.hasOwnProperty("preset_words")&&e.preset_words.words&&(e.preset_words.words=e.preset_words.words.filter(i=>i.type!=="ad"),t={body:JSON.stringify(e)})}}catch(e){$.logger.error(`\u53BB\u9664\u9884\u7F6E\u5173\u952E\u5B57\u5E7F\u544A\u51FA\u73B0\u5F02\u5E38\uFF1A${e}`)}return t}function removeNextBlackUserAnswer(){let t=null;try{if($.response.body){let e=JSON.parse($.response.body);const i=$.data.read(blackAnswersIdKey,[]);if(i.length>0){let s=[];e.data.forEach(o=>{i.includes(o.id.toString())===!1?(o.ad_info={data:""},s.push(o)):$.notification.debug(`\u5C4F\u853D\u7FFB\u9875\u8FC7\u7A0B\u4E2D\u51FA\u73B0\u7684\u9ED1\u540D\u5355\u7528\u6237\u56DE\u7B54Id:${o.id}`)});for(let o=0;o<s.length;o++)s[o].extra&&s[o].extra.question_index&&(s[o].extra.question_index=o+1),s[o].strategy_info&&(s[o].strategy_info.global_index=o+1,s[o].strategy_info.strategy_index=o+1);e.data=s}t={body:JSON.stringify(e)}}}catch(e){$.logger.error(`\u5C4F\u853D\u4E0B\u7FFB\u9ED1\u540D\u5355\u7528\u6237\u7684\u56DE\u7B54\u51FA\u73B0\u5F02\u5E38\uFF1A${e}`)}return t}function modifyAnswersNextData(){let t=null;try{if($.response.body){let e=JSON.parse($.response.body),i=getUserInfo(),s=$.data.read(blockedUsersKey,{},i.id);$.logger.debug(`\u811A\u672C\u9ED1\u540D\u5355\u7528\u6237\uFF1A
${JSON.stringify(s)}`);let o=[];e.data.data.forEach(d=>{if((d.resource_type==="ad"||d.extra.recommend_start===!0||d.next_guide.change_type===1||d.next_guide.title==="\u63A8\u8350\u7684\u76F8\u5173\u5185\u5BB9")===!0)return;d.ad_info={data:""};const p=typeof s[d.data.author.name]<"u";$.logger.debug(`\u7528\u6237${d.data.author.name}\u662F\u5426\u5728\u9ED1\u540D\u5355\u4E2D\uFF1A${p}`),($.data.read("zhihu_settings_blocked_users",!1)===!1||p===!1)&&o.push(d)}),e.data.data=o,t={body:JSON.stringify(e)}}}catch(e){$.logger.error(`\u5C4F\u853D\u56DE\u7B54\u4FE1\u606F\u6D41\u9ED1\u540D\u5355\u7528\u6237\u53CA\u5E7F\u544A\uFF1A${e}`)}return t}function modifyAnswersNextBff(){let t=null;try{if($.response.body){let e=JSON.parse($.response.body),i=getUserInfo(),s=$.data.read(blockedUsersKey,{},i.id);$.logger.debug(`\u811A\u672C\u9ED1\u540D\u5355\u7528\u6237\uFF1A
${JSON.stringify(s)}`);let o=[];e.data.forEach(d=>{if(d.origin_data.resource_type!=="normal"===!0)return;d.origin_data.ad_info={data:""};const p=d.origin_data.data.author.name,g=typeof s[p]<"u";$.logger.debug(`\u7528\u6237${p}\u662F\u5426\u5728\u9ED1\u540D\u5355\u4E2D\uFF1A${g}`),($.data.read("zhihu_settings_blocked_users",!1)===!1||g===!1)&&o.push(d)}),e.data=o,t={body:JSON.stringify(e)}}}catch(e){$.logger.error(`\u5C4F\u853D\u56DE\u7B54\u4FE1\u606F\u6D41\u9ED1\u540D\u5355\u7528\u6237\u53CA\u5E7F\u544A\uFF1A${e}`)}return t}function modifyAnswersNextRender(){let t=null;try{if($.response.body){let e=JSON.parse($.response.body),i=getUserInfo(),s=$.data.read(blockedUsersKey,{},i.id);$.logger.debug(`\u811A\u672C\u9ED1\u540D\u5355\u7528\u6237\uFF1A
${JSON.stringify(s)}`);let o=[];e.data.forEach(d=>{if((d.ad_info&&d.ad_info.data!==""||d.biz_type_list&&d.biz_type_list.length!==1||d.biz_type_list&&d.biz_type_list[0]!=="answer"||d.type==="ad")===!0)return;const p=d.author.fullname,g=typeof s[p]<"u";$.logger.debug(`\u7528\u6237${p}\u662F\u5426\u5728\u9ED1\u540D\u5355\u4E2D\uFF1A${g}`),($.data.read("zhihu_settings_blocked_users",!1)===!1||g===!1)&&o.push(d)}),e.data=o,t={body:JSON.stringify(e)}}}catch(e){$.logger.error(`\u5C4F\u853D\u56DE\u7B54\u4FE1\u606F\u6D41\u9ED1\u540D\u5355\u7528\u6237\u53CA\u5E7F\u544A\uFF1A${e}`)}return t}function changeUserCredit(){$.notification.debug("\u5F00\u59CB\u4FEE\u6539\u7528\u6237\u76D0\u503C");let t=null;try{if($.response.body){const e=parseInt($.data.read(userCreditScoreKey,780));$.logger.debug(`\u51C6\u5907\u4FEE\u6539\u7528\u6237\u76D0\u503C\u4E3A${e}`);let i=JSON.parse($.response.body);i.credit_basis.total_score<e&&(i.credit_basis.total_score=e,$.logger.debug(`\u5DF2\u4FEE\u6539\u7528\u6237\u76D0\u503C\u4E3A:${e}`)),t={body:JSON.stringify(i)}}}catch(e){$.logger.error(`\u4FEE\u6539\u7528\u6237\u76D0\u503C\u51FA\u73B0\u5F02\u5E38\uFF1A${e}`)}return t}(async()=>{let t=null;if($.isResponse)switch(!0){case/^https:\/\/api\.zhihu\.com\/people\/self$/.test($.request.url):t=processUserInfo();break;case($.data.read("zhihu_settings_app_conf",!1)===!0&&/^https?:\/\/appcloud2\.zhihu\.com\/v\d+\/config/.test($.request.url)):t=modifyAppConfig();break;case($.data.read("zhihu_settings_app_conf",!1)===!0&&/^https?:\/\/m-cloud\.zhihu\.com\/api\/cloud\/config\/all\?/.test($.request.url)):t=modifyMCloudConfig();break;case($.data.read("zhihu_settings_app_conf",!1)===!0&&/^https?:\/\/api\.zhihu\.com\/feed\/render\/tab\/config/.test($.request.url)):t=modifyAppTabConfig();break;case/^https?:\/\/api\.zhihu\.com\/user-credit\/basis/.test($.request.url):t=changeUserCredit();break;case/^https:\/\/api\.zhihu\.com\/topstory\/recommend/.test($.request.url):t=await removeRecommend();break;case/^https?:\/\/api\.zhihu\.com\/(v4\/)?questions\/\d+/.test($.request.url):t=removeQuestions();break;case/^https?:\/\/api\.zhihu\.com\/next-data\?/.test($.request.url):t=modifyAnswersNextData();break;case/^https?:\/\/api\.zhihu\.com\/next-bff\?/.test($.request.url):t=modifyAnswersNextBff();break;case/^https?:\/\/api\.zhihu\.com\/next-render\?/.test($.request.url):t=modifyAnswersNextRender();break;case($.data.read("zhihu_settings_sys_msg",!0)!==!1&&/^https?:\/\/api\.zhihu\.com\/notifications\/v3\/message/.test($.request.url)):t=removeMarketingMsg();break;case/^https?:\/\/api\.zhihu\.com\/comment_v5\/(answers|pins|comments?|articles)\/\d+\/(root|child)_comment/.test($.request.url):t=removeComment();break;case/^https?:\/\/www\.zhihu\.com\/api\/v\d\/articles\/\d+\/recommendation\?/.test($.request.url):t=removeArticleAd();break;case/^https?:\/\/www\.zhihu\.com\/api\/v4\/comment_v5\/answers\/\d+\/abstract_comment\?/.test($.request.url):t=removeComment();break;case($.data.read("zhihu_settings_answer_tip",!0)===!0&&/^https?:\/\/www\.zhihu\.com\/appview\/v2\/answer\/.*(entry=(?!(preload-topstory|preload-search|preload-subscription)))?/.test($.request.url)):t=modifyAnswer();break;case($.data.read("zhihu_settings_blocked_users",!1)!==!1&&/^https?:\/\/api\.zhihu\.com\/next\?/.test($.request.url)):t=removeNextBlackUserAnswer();break;case($.data.read("zhihu_settings_blocked_users",!0)===!0&&/^https?:\/\/api\.zhihu\.com\/people\/((?!self).)*$/.test($.request.url)):t=autoInsertBlackList();break;case/^https?:\/\/api\.zhihu\.com\/moments_v3\?/.test($.request.url):t=removeMoments();break;case($.data.read("zhihu_settings_hot_list",!0)===!0&&/^https?:\/\/api\.zhihu\.com\/topstory\/hot-lists(\?|\/)/.test($.request.url)):t=removeHotListAds();break;case($.data.read("zhihu_settings_preset_words",!0)===!0&&/^https?:\/\/api\.zhihu\.com\/search\/preset_words\?/.test($.request.url)):t=removeKeywordAds();break;case($.data.read("zhihu_settings_blocked_users",!1)!==!1&&/^https?:\/\/api\.zhihu\.com\/settings\/blocked_users/.test($.request.url)):manageBlackUser();break;default:$.logger.debug("\u6CA1\u6709\u5339\u914D\u5230\u4EFB\u4F55\u8BF7\u6C42\uFF0C\u8BF7\u786E\u8BA4\u914D\u7F6E\u6B63\u786E\u3002");break}else $.isRequest?$.data.read("zhihu_settings_blocked_keywords",!1)!==!1&&/^https?:\/\/api\.zhihu\.com\/feed-root\/block/.test($.request.url)===!0&&(t=unlockBlockedKeywords(t)):($.data.del(currentUserInfoKey),$.data.del(blockedUsersKey),$.data.del(keywordBlockKey),$.notification.post("\u54F2\u4E5F\u540C\u5B66\u6570\u636E\u6E05\u7406\u5B8C\u6BD5"));t?$.done(t):$.done()})();function MagicJS(t="MagicJS",e="INFO"){const i=()=>{const o=typeof $loon<"u",d=typeof $task<"u",c=typeof module<"u",p=typeof $httpClient<"u"&&!o,g=typeof $storm<"u",h=typeof $environment<"u"&&typeof $environment["stash-build"]<"u",_=p||o||g||h,f=typeof importModule<"u";return{isLoon:o,isQuanX:d,isNode:c,isSurge:p,isStorm:g,isStash:h,isSurgeLike:_,isScriptable:f,get name(){return o?"Loon":d?"QuantumultX":c?"NodeJS":p?"Surge":f?"Scriptable":"unknown"},get build(){if(p)return $environment["surge-build"];if(h)return $environment["stash-build"];if(g)return $storm.buildVersion},get language(){if(p||h)return $environment.language},get version(){if(p)return $environment["surge-version"];if(h)return $environment["stash-version"];if(g)return $storm.appVersion;if(c)return process.version},get system(){if(p)return $environment.system;if(c)return process.platform},get systemVersion(){if(g)return $storm.systemVersion},get deviceName(){if(g)return $storm.deviceName}}},s=(o,d="INFO")=>{let c=d;const p={SNIFFER:6,DEBUG:5,INFO:4,NOTIFY:3,WARNING:2,ERROR:1,CRITICAL:0,NONE:-1},g={SNIFFER:"",DEBUG:"",INFO:"",NOTIFY:"",WARNING:"\u2757 ",ERROR:"\u274C ",CRITICAL:"\u274C ",NONE:""},h=(f,b="INFO")=>{p[c]<p[b.toUpperCase()]};return{getLevel:()=>c,setLevel:f=>{c=f},sniffer:f=>{h(f,"SNIFFER")},debug:f=>{h(f,"DEBUG")},info:f=>{h(f,"INFO")},notify:f=>{h(f,"NOTIFY")},warning:f=>{h(f,"WARNING")},error:f=>{h(f,"ERROR")},retry:f=>{h(f,"RETRY")}}};return new class{constructor(o,d){if(this._startTime=Date.now(),this.version="3.0.0",this.scriptName=o,this.env=i(),this.logger=s(o,d),this.http=typeof MagicHttp=="function"?MagicHttp(this.env,this.logger):void 0,this.data=typeof MagicData=="function"?MagicData(this.env,this.logger):void 0,this.notification=typeof MagicNotification=="function"?MagicNotification(this.scriptName,this.env,this.logger,this.http):void 0,this.utils=typeof MagicUtils=="function"?MagicUtils(this.env,this.logger):void 0,this.qinglong=typeof MagicQingLong=="function"?MagicQingLong(this.env,this.data,this.logger):void 0,typeof this.data<"u"){let c=this.data.read("magic_loglevel");const p=this.data.read("magic_bark_url");c&&this.logger.setLevel(c.toUpperCase()),p&&this.notification.setBark(p)}}get isRequest(){return typeof $request<"u"&&typeof $response>"u"}get isResponse(){return typeof $response<"u"}get isDebug(){return this.logger.level==="DEBUG"}get request(){return typeof $request<"u"?$request:void 0}get response(){if(typeof $response<"u")return $response.hasOwnProperty("status")&&($response.statusCode=$response.status),$response.hasOwnProperty("statusCode")&&($response.status=$response.statusCode),$response}done=(o={})=>{this._endTime=Date.now();let d=(this._endTime-this._startTime)/1e3;this.logger.info(`SCRIPT COMPLETED: ${d} S.`),typeof $done<"u"&&$done(o)}}(t,e)}function MagicNotification(t,e,i,s){let o=null,d=null;const c=_=>{try{let f=_.replace(/\/+$/g,"");o=`${/^https?:\/\/([^/]*)/.exec(f)[0]}/push`,d=/\/([^\/]+)\/?$/.exec(f)[1]}catch(f){i.error(`Bark url error: ${f}.`)}};function p(_=t,f="",b="",O=""){O=(w=>{try{let a={};if(typeof w=="string")e.isLoon?a={openUrl:w}:e.isQuanX?a={"open-url":w}:e.isSurge&&(a={url:w});else if(typeof w=="object"){if(e.isLoon)a.openUrl=w["open-url"]?w["open-url"]:"",a.mediaUrl=w["media-url"]?w["media-url"]:"";else if(e.isQuanX)a=w["open-url"]||w["media-url"]?w:{};else if(e.isSurge){let u=w["open-url"]||w.openUrl;a=u?{url:u}:{}}}return a}catch(a){i.error(`\u901A\u77E5\u9009\u9879\u8F6C\u6362\u5931\u8D25${a}`)}return w})(O),arguments.length===1&&(_=t,f="",b=arguments[0]),i.notify(`title:${_}
subTitle:${f}
body:${b}
options:${typeof O=="object"?JSON.stringify(O):O}`),e.isSurge?$notification.post(_,f,b,O):e.isLoon?O?$notification.post(_,f,b,O):$notification.post(_,f,b):e.isQuanX&&$notify(_,f,b,O),o&&d&&h(_,f,b)}function g(_=t,f="",b="",O=""){i.getLevel()==="DEBUG"&&(arguments.length===1&&(_=t,f="",b=arguments[0]),this.post(_,f,b,O))}function h(_=t,f="",b="",O=""){if(typeof s>"u"||typeof s.post>"u")throw"Bark notification needs to import MagicHttp module.";let y={url:o,headers:{"content-type":"application/json; charset=utf-8"},body:{title:_,body:f?`${f}
${b}`:b,device_key:d}};s.post(y).catch(w=>{i.error(`Bark notify error: ${w}`)})}return{post:p,debug:g,bark:h,setBark:c}}function MagicData(t,e){let i={fs:void 0,data:{}};if(t.isNode){i.fs=require("fs");try{i.fs.accessSync("./magic.json",i.fs.constants.R_OK|i.fs.constants.W_OK)}catch{i.fs.writeFileSync("./magic.json","{}",{encoding:"utf8"})}i.data=require("./magic.json")}const s=(a,u)=>typeof u=="object"?!1:a===u,o=a=>a==="true"?!0:a==="false"?!1:typeof a>"u"?null:a,d=(a,u,r,n)=>{if(r)try{typeof a=="string"&&(a=JSON.parse(a)),a.magic_session===!0?a=a[r]:a=null}catch{a=null}if(typeof a=="string"&&a!=="null")try{a=JSON.parse(a)}catch{}return n===!1&&a&&a.magic_session===!0&&(a=null),(a===null||typeof a>"u")&&u!==null&&typeof u<"u"&&(a=u),a=o(a),a},c=a=>{if(typeof a=="string"){let u={};try{u=JSON.parse(a);const r=typeof u;(r!=="object"||u instanceof Array||r==="bool"||u===null)&&(u={})}catch{}return u}else return a instanceof Array||a===null||typeof a>"u"||a!==a||typeof a=="boolean"?{}:a},p=(a,u=null,r="",n=!1,l=null)=>{let m=l||i.data;return m&&typeof m[a]<"u"&&m[a]!==null?val=m[a]:val=r?{}:null,val=d(val,u,r,n),val},g=(a,u=null,r="",n=!1,l=null)=>{let m="";return l||t.isNode?m=p(a,u,r,n,l):(t.isSurgeLike?m=$persistentStore.read(a):t.isQuanX&&(m=$prefs.valueForKey(a)),m=d(m,u,r,n)),e.debug(`READ DATA [${a}]${r?`[${r}]`:""} <${typeof m}>
${JSON.stringify(m)}`),m},h=(a,u,r="",n=null)=>{let l=n||i.data;if(l=c(l),r){let m=c(l[a]);m.magic_session=!0,m[r]=u,l[a]=m}else l[a]=u;return n!==null&&(n=l),l},_=(a,u,r="",n=null)=>{if(typeof u>"u"||u!==u)return!1;!t.isNode&&(typeof u=="boolean"||typeof u=="number")&&(u=String(u));let l="";if(n||t.isNode?l=h(a,u,r,n):r?(t.isSurgeLike?l=$persistentStore.read(a)?$persistentStore.read(a):l:t.isQuanX&&(l=$prefs.valueForKey(a)?$prefs.valueForKey(a):l),l=c(l),l.magic_session=!0,l[r]=u):l=u,l&&typeof l=="object"&&(l=JSON.stringify(l,null,4)),e.debug(`WRITE DATA [${a}]${r?`[${r}]`:""} <${typeof u}>
${JSON.stringify(u)}`),!n){if(t.isSurgeLike)return $persistentStore.write(l,a);if(t.isQuanX)return $prefs.setValueForKey(l,a);if(t.isNode)try{return i.fs.writeFileSync("./magic.json",l),!0}catch(m){return e.error(m),!1}}return!0},f=(a,u,r,n=s,l=null)=>{u=o(u);const m=g(a,null,r,!1,l);if(n(m,u)===!0)return!1;{const k=_(a,u,r,l);let q=g(a,null,r,!1,l);return n===s&&typeof q=="object"?k:n(u,q)}},b=(a,u,r)=>{let n=r||i.data;return n=c(n),u?(obj=c(n[a]),delete obj[u],n[a]=obj):delete n[a],r&&(r=n),n};return{read:g,write:_,del:(a,u="",r=null)=>{let n={};if(r||t.isNode)n=b(a,u,r),r?r=n:i.fs.writeFileSync("./magic.json",JSON.stringify(n,null,4));else if(u){t.isSurgeLike?n=$persistentStore.read(a):t.isQuanX&&(n=$prefs.valueForKey(a)),n=c(n),delete n[u];const l=JSON.stringify(n,null,4);_(a,l)}else{if(t.isStorm)return $persistentStore.remove(a);if(t.isSurgeLike)return $persistentStore.write(null,a);if(t.isQuanX)return $prefs.removeValueForKey(a)}e.debug(`DELETE KEY [${a}]${u?`[${u}]`:""}`)},update:f,allSessions:(a,u=null)=>{let r={},n=g(a,null,null,!0,u);return n=c(n),n.magic_session===!0&&(r={...n},delete r.magic_session),e.debug(`READ ALL SESSIONS [${a}] <${typeof r}>
${JSON.stringify(r,null,4)}`),r},allSessionNames:(a,u=null)=>{let r=[],n=g(a,null,null,!0,u);return n=c(n),n.magic_session!==!0?r=[]:r=Object.keys(n).filter(l=>l!=="magic_session"),e.debug(`READ ALL SESSIONS [${a}] <${typeof r}>
${JSON.stringify(r,null,4)}`),r},defaultValueComparator:s,convertToObject:c}}function MagicHttp(t,e){let i;t.isNode&&(i=require("axios").create());class s{constructor(n=!0){this.handlers=[],this.isRequest=n}use(n,l,m){return typeof n=="function"&&e.debug(`Register fulfilled ${n.name}`),typeof l=="function"&&e.debug(`Register rejected ${l.name}`),this.handlers.push({fulfilled:n,rejected:l,synchronous:m&&typeof m.synchronous=="boolean"?m.synchronous:!1,runWhen:m?m.runWhen:null}),this.handlers.length-1}eject(n){this.handlers[n]&&(this.handlers[n]=null)}forEach(n){this.handlers.forEach(l=>{l!==null&&n(l)})}}function o(r){let n={...r};if(n.params&&!t.isNode){let l=Object.keys(n.params).map(m=>{const k=encodeURIComponent(m);return n.url=n.url.replace(new RegExp(`${m}=[^&]*`,"ig"),""),n.url=n.url.replace(new RegExp(`${k}=[^&]*`,"ig"),""),`${k}=${encodeURIComponent(n.params[m])}`}).join("&");n.url.indexOf("?")<0&&(n.url+="?"),/(&|\?)$/g.test(n.url)||(n.url+="&"),n.url+=l,delete n.params,e.debug(`Params to QueryString: ${n.url}`)}return n}const d=(r,n)=>{let l=typeof n=="object"?{headers:{},...n}:{url:n,headers:{}};if(l.method||(l.method=r),l=o(l),l.rewrite===!0&&(t.isSurge?(l.headers["X-Surge-Skip-Scripting"]=!1,delete l.rewrite):t.isQuanX&&(l.hints=!1,delete l.rewrite)),t.isSurgeLike){const m=l.headers["content-type"]||l.headers["Content-Type"];l.method!=="GET"&&m&&m.indexOf("application/json")>=0&&l.body instanceof Array&&(l.body=JSON.stringify(l.body),e.debug(`Convert Array object to String: ${l.body}`))}else t.isQuanX?(l.hasOwnProperty("body")&&typeof l.body!="string"&&(l.body=JSON.stringify(l.body)),l.method=r):t.isNode&&(r==="POST"||r==="PUT"||r==="PATCH"||r==="DELETE"?l.data=l.data||l.body:r==="GET"&&(l.params=l.params||l.body),delete l.body);return l},c=(r,n=null)=>{if(r){let l={...r,config:r.config||n,status:r.statusCode||r.status,body:r.body||r.data,headers:r.headers||r.header};if(typeof l.body=="string")try{l.body=JSON.parse(l.body)}catch{}return delete l.data,l}else return r},p=r=>Object.keys(r).reduce((n,l)=>(n[l.toLowerCase()]=r[l],n),{}),g=r=>Object.keys(r).reduce((n,l)=>{const m=l.split("-").map(k=>k[0].toUpperCase()+k.slice(1)).join("-");return n[m]=r[l],n},{}),h=(r,n=null)=>{if(r&&r.status>=400)return e.debug(`Raise exception when status code is ${r.status}`),{name:"RequestException",message:`Request failed with status code ${r.status}`,config:n||r.config,response:r}},_={request:new s,response:new s(!1)};let f=[],b=[],O=!0;function y(r){return r=o(r),e.debug(`HTTP ${r.method.toUpperCase()}:
${JSON.stringify(r)}`),r}function w(r){try{r=r&&c(r),e.sniffer(`HTTP ${r.config.method.toUpperCase()}:
${JSON.stringify(r.config)}
STATUS CODE:
${r.status}
RESPONSE:
${typeof r.body=="object"?JSON.stringify(r.body):r.body}`);const n=h(r);return n?Promise.reject(n):r}catch(n){return e.error(n),r}}const a=r=>{try{f=[],b=[],_.request.forEach(n=>{typeof n.runWhen=="function"&&n.runWhen(r)===!1||(O=O&&n.synchronous,f.unshift(n.fulfilled,n.rejected))}),_.response.forEach(n=>{b.push(n.fulfilled,n.rejected)})}catch(n){e.error(`Failed to register interceptors: ${n}.`)}},u=(r,n)=>{let l;const m=r.toUpperCase();n=d(m,n),t.isNode?l=i:t.isSurgeLike?l=S=>new Promise((v,x)=>{$httpClient[r.toLowerCase()](S,(N,z,J)=>{if(N){let j={name:N.name||N,message:N.message||N,stack:N.stack||N,config:S,response:c(z)};x(j)}else z.config=S,z.body=J,v(z)})}):l=S=>new Promise((v,x)=>{$task.fetch(S).then(N=>{N=c(N,S);const z=h(N,S);if(z)return Promise.reject(z);v(N)}).catch(N=>{let z={name:N.message||N.error,message:N.message||N.error,stack:N.error,config:S,response:N.response?c(N.response):null};x(z)})});let k;a(n);const q=[y,void 0],E=[w,void 0];if(O){for(e.debug("Interceptors are executed in synchronous mode"),Array.prototype.unshift.apply(f,q),f=f.concat([y,void 0]);f.length;){let S=f.shift(),v=f.shift();try{typeof S=="function"&&e.debug(`Executing request fulfilled ${S.name}`),n=S(n)}catch(x){typeof v=="function"&&e.debug(`Executing request rejected ${v.name}`),v(x);break}}try{!t.isNode&&n.timeout?k=C(n):k=l(n)}catch(S){return Promise.reject(S)}for(Array.prototype.unshift.apply(b,E);b.length;)k=k.then(b.shift(),b.shift());return k}else{e.debug("Interceptors are executed in asynchronous mode");let S=[l,void 0];for(Array.prototype.unshift.apply(S,q),Array.prototype.unshift.apply(S,f),S=S.concat(E),S=S.concat(b),k=Promise.resolve(n);S.length;)try{let v=S.shift(),x=S.shift();!t.isNode&&n.timeout&&v===l&&(v=C),typeof v=="function"&&e.debug(`Executing request fulfilled ${v.name}`),typeof x=="function"&&e.debug(`Executing request rejected ${x.name}`),k=k.then(v,x)}catch(v){e.error(`request exception: ${v}`)}return k}function C(S){try{const v=new Promise((x,N)=>{setTimeout(()=>{let z={message:`timeout of ${S.timeout}ms exceeded.`,config:S};N(z)},S.timeout)});return Promise.race([l(S),v])}catch(v){e.error(`Request Timeout exception: ${v}.`)}}};return{request:u,interceptors:_,convertHeadersToLowerCase:p,convertHeadersToCamelCase:g,modifyResponse:c,get:r=>u("GET",r),post:r=>u("POST",r),put:r=>u("PUT",r),patch:r=>u("PATCH",r),delete:r=>u("DELETE",r),head:r=>u("HEAD",r),options:r=>u("OPTIONS",r)}}
