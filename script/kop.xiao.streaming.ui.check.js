// https://raw.githubusercontent.com/KOP-XIAO/QuantumultX/master/Scripts/streaming-ui-check.js
const e="https://www.youtube.com/premium",t="https://startup.core.indazn.com/misl/v5/Startup",i="https://www.paramountplus.com/",o="Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/94.0.4606.61 Safari/537.36";var n={policy:$environment.params},a={policy:$environment.params,redirection:!1},r=new Map([["AC","🇦🇨"],["AE","🇦🇪"],["AF","🇦🇫"],["AI","🇦🇮"],["AL","🇦🇱"],["AM","🇦🇲"],["AQ","🇦🇶"],["AR","🇦🇷"],["AS","🇦🇸"],["AT","🇦🇹"],["AU","🇦🇺"],["AW","🇦🇼"],["AX","🇦🇽"],["AZ","🇦🇿"],["BA","🇧🇦"],["BB","🇧🇧"],["BD","🇧🇩"],["BE","🇧🇪"],["BF","🇧🇫"],["BG","🇧🇬"],["BH","🇧🇭"],["BI","🇧🇮"],["BJ","🇧🇯"],["BM","🇧🇲"],["BN","🇧🇳"],["BO","🇧🇴"],["BR","🇧🇷"],["BS","🇧🇸"],["BT","🇧🇹"],["BV","🇧🇻"],["BW","🇧🇼"],["BY","🇧🇾"],["BZ","🇧🇿"],["CA","🇨🇦"],["CF","🇨🇫"],["CH","🇨🇭"],["CK","🇨🇰"],["CL","🇨🇱"],["CM","🇨🇲"],["CN","🇨🇳"],["CO","🇨🇴"],["CP","🇨🇵"],["CR","🇨🇷"],["CU","🇨🇺"],["CV","🇨🇻"],["CW","🇨🇼"],["CX","🇨🇽"],["CY","🇨🇾"],["CZ","🇨🇿"],["DE","🇩🇪"],["DG","🇩🇬"],["DJ","🇩🇯"],["DK","🇩🇰"],["DM","🇩🇲"],["DO","🇩🇴"],["DZ","🇩🇿"],["EA","🇪🇦"],["EC","🇪🇨"],["EE","🇪🇪"],["EG","🇪🇬"],["EH","🇪🇭"],["ER","🇪🇷"],["ES","🇪🇸"],["ET","🇪🇹"],["EU","🇪🇺"],["FI","🇫🇮"],["FJ","🇫🇯"],["FK","🇫🇰"],["FM","🇫🇲"],["FO","🇫"],["FR","🇫🇷"],["GA","🇬🇦"],["GB","🇬🇧"],["HK","🇭🇰"],["HU","🇭🇺"],["ID","🇮🇩"],["IE","🇮🇪"],["IL","🇮🇱"],["IM","🇮🇲"],["IN","🇮🇳"],["IS","🇮🇸"],["IT","🇮🇹"],["JP","🇯🇵"],["KR","🇰🇷"],["LU","🇱🇺"],["MO","🇲🇴"],["MX","🇲🇽"],["MY","🇲🇾"],["NL","🇳🇱"],["PH","🇵🇭"],["RO","🇷🇴"],["RS","🇷🇸"],["RU","🇷🇺"],["RW","🇷🇼"],["SA","🇸🇦"],["SB","🇧"],["SC","🇸🇨"],["SD","🇸🇩"],["SE","🇸🇪"],["SG","🇸🇬"],["TH","🇹🇭"],["TN","🇹🇳"],["TO","🇹🇴"],["TR","🇹🇷"],["TV","🇹🇻"],["TW","🇨🇳"],["UK","🇬🇧"],["UM","🇺🇲"],["US","🇺🇸"],["UY","🇺🇾"],["UZ","🇺🇿"],["VA","🇻🇦"],["VE","🇻🇪"],["VG","🇻🇬"],["VI","🇻🇮"],["VN","🇻🇳"],["ZA","🇿🇦"]]);let s={title:"    📺  流媒体服务查询",YouTube:"<b>YouTube: </b>检测失败，请重试 ❗️",Netflix:"<b>Netflix: </b>检测失败，请重试 ❗️",Dazn:"<b>Dazn: </b>检测失败，请重试 ❗️",Disney:"<b>Disneyᐩ: </b>检测失败，请重试 ❗️",Paramount:"<b>Paramountᐩ: </b>检测失败，请重试 ❗️",Discovery:"<b>Discoveryᐩ: </b>检测失败，请重试 ❗️",ChatGPT:"<b>ChatGPT: </b>检测失败，请重试 ❗️"};const l={action:"get_policy_state",content:$environment.params};async function u(){try{let{region:e,cnbl:t}=await Promise.race([new Promise(((e,t)=>{let i={url:"https://www.disneyplus.com/",opts:n,headers:{"Accept-Language":"en","User-Agent":o}};$task.fetch(i).then((i=>{let o=i.body;if(200===i.statusCode&&-1===o.indexOf("not available in your region")){let t=o.match(/Region: ([A-Za-z]{2})[\s\S]*?CNBL: ([12])/);if(!t)return void e({region:"",cnbl:""});{let i=t[1],o=t[2];e({region:i,cnbl:o})}}else t("Not Available")}),(e=>{t("Error")}))})),c(7e3)]),{countryCode:i,inSupportedLocation:a,accessToken:r}=await Promise.race([new Promise(((e,t)=>{let i={url:"https://disney.api.edge.bamgrid.com/graph/v1/device/graphql",method:"POST",opts:n,headers:{"Accept-Language":"en",Authorization:"ZGlzbmV5JmJyb3dzZXImMS4wLjA.Cu56AgSfBTDag5NiRA81oLHkDZfu5L3CKadnefEAY84","Content-Type":"application/json","User-Agent":o},body:JSON.stringify({query:"mutation registerDevice($input: RegisterDeviceInput!) { registerDevice(registerDevice: $input) { grant { grantType assertion } } }",variables:{input:{applicationRuntime:"chrome",attributes:{browserName:"chrome",browserVersion:"94.0.4606",manufacturer:"apple",model:null,operatingSystem:"macintosh",operatingSystemVersion:"10.15.7",osDeviceIds:[]},deviceFamily:"browser",deviceLanguage:"en",deviceProfile:"macosx"}}})};$task.fetch(i).then((i=>{let o=i.body;if(200===i.statusCode){let{token:{accessToken:t},session:{inSupportedLocation:i,location:{countryCode:n}}}=JSON.parse(o)?.extensions?.sdk;e({inSupportedLocation:i,countryCode:n,accessToken:t})}else t("Not Available")}),(e=>{t("Error")}))})),c(7e3)]);return e=i??e,!1===a||"false"===a?{region:e,status:2}:{region:e,status:1}}catch(e){return"Not Available"===e?{status:0}:"Timeout"===e?{status:-1}:{status:-2}}}function c(e=5e3){return new Promise(((t,i)=>{setTimeout((()=>{i("Timeout")}),e)}))}(async()=>{!function(){let t={url:e,opts:n,timeout:2800,headers:{"User-Agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/94.0.4606.61 Safari/537.36"}};$task.fetch(t).then((e=>{let t=e.body;if(200!==e.statusCode)s.YouTube="<b>YouTube Premium: </b>检测失败 ❗️";else if(-1!==t.indexOf("Premium is not available in your country"))s.YouTube="<b>YouTube Premium: </b>未支持 🚫";else if(-1==t.indexOf("Premium is not available in your country")){let e="",i=new RegExp('"GL":"(.*?)"',"gm").exec(t);e=null!=i&&2===i.length?i[1]:-1!==t.indexOf("www.google.cn")?"CN":"US",s.YouTube="<b>YouTube Premium: </b>支持  ➟ ⟦"+r.get(e.toUpperCase())+"⟧ 🎉"}}),(e=>{s.YouTube="<b>YouTube Premium: </b>检测超时 🚦"}))}(),function(){let e={url:t,method:"POST",opts:n,timeout:2800,headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.87 Safari/537.36","Content-Type":"application/json"},body:'{\n    "LandingPageKey":"generic",\n    "Platform":"web",\n    "PlatformAttributes":{},\n    "Manufacturer":"",\n    "PromoCode":"",\n    "Version":"2"\n  }'};$task.fetch(e).then((e=>{let t=e.body;JSON.stringify(e.headers);if(200!==e.statusCode)s.Dazn="<b>Dazn: </b>检测失败 ❗️";else if(200==e.statusCode){let e="",i=new RegExp('"GeolocatedCountry":"(.*?)"',"gm").exec(t);null!=i&&2===i.length?(e=i[1],s.Dazn="<b>Dazn: </b>支持  ➟ ⟦"+r.get(e.toUpperCase())+"⟧ 🎉"):s.Dazn="<b>Dazn: </b>未支持 🚫"}}),(e=>{s.Dazn="<b>Dazn: </b>检测超时 🚦"}))}(),function(){let e={url:i,opts:a,timeout:2800,headers:{"User-Agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/94.0.4606.61 Safari/537.36"}};$task.fetch(e).then((e=>{200==e.statusCode?s.Paramount="<b>Paramountᐩ: </b>支持 🎉 ":302==e.statusCode&&(s.Paramount="<b>Paramountᐩ: </b>未支持 🚫")}),(e=>{s.Paramount="<b>Paramountᐩ: </b>检测超时 🚦"}))}();let[{region:o,status:c}]=await Promise.all([u(),(b=81280792,new Promise(((e,t)=>{let i={url:"https://www.netflix.com/title/"+b,opts:n,timeout:5200,headers:{"User-Agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/94.0.4606.61 Safari/537.36"}};$task.fetch(i).then((t=>{if(404===t.statusCode)return s.Netflix="<b>Netflix: </b>支持自制剧集 ⚠️",void e("Not Found");if(403===t.statusCode)return s.Netflix="<b>Netflix: </b>未支持 🚫",void e("Not Available");if(200===t.statusCode){let i=t.headers["X-Originating-URL"],o=i.split("/")[3];return o=o.split("-")[0],"title"==o&&(o="us"),s.Netflix="<b>Netflix: </b>完整支持 ➟ ⟦"+r.get(o.toUpperCase())+"⟧ 🎉",void e("nf:"+s.Netflix)}e("Netflix Test Error")}),(t=>{s.Netflix="<b>Netflix: </b>检测超时 🚦",e("timeout")}))}))),new Promise(((e,t)=>{let i={url:"https://us1-prod-direct.discoveryplus.com/token?deviceId=d1a4a5d25212400d1e6985984604d740&realm=go&shortlived=true",opts:a,timeout:2800,headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.87 Safari/537.36"},verify:!1};$task.fetch(i).then((t=>{if(200==t.statusCode){let i=JSON.parse(t.body),o=i.data.attributes.token;const n=`_gcl_au=1.1.858579665.1632206782; _rdt_uuid=1632206782474.6a9ad4f2-8ef7-4a49-9d60-e071bce45e88; _scid=d154b864-8b7e-4f46-90e0-8b56cff67d05; _pin_unauth=dWlkPU1qWTRNR1ZoTlRBdE1tSXdNaTAwTW1Nd0xUbGxORFV0WWpZMU0yVXdPV1l6WldFeQ; _sctr=1|1632153600000; aam_fw=aam%3D9354365%3Baam%3D9040990; aam_uuid=24382050115125439381416006538140778858; st=${o}; gi_ls=0; _uetvid=a25161a01aa711ec92d47775379d5e4d; AMCV_BC501253513148ED0A490D45%40AdobeOrg=-1124106680%7CMCIDTS%7C18894%7CMCMID%7C24223296309793747161435877577673078228%7CMCAAMLH-1633011393%7C9%7CMCAAMB-1633011393%7CRKhpRz8krg2tLO6pguXWp5olkAcUniQYPHaMWWgdJ3xzPWQmdj0y%7CMCOPTOUT-1632413793s%7CNONE%7CvVersion%7C5.2.0; ass=19ef15da-95d6-4b1d-8fa2-e9e099c9cc38.1632408400.1632406594`;let r={url:"https://us1-prod-direct.discoveryplus.com/users/me",opts:a,timeout:2800,headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.87 Safari/537.36",Cookie:n},ciphers:"DEFAULT@SECLEVEL=1",verify:!1};$task.fetch(r).then((t=>{let i=JSON.parse(t.body),o=i.data.attributes.currentLocationTerritory;return"us"==o?(s.Discovery="<b>Discoveryᐩ: </b>支持 🎉 ",void e("支持 Discoveryᐩ")):(s.Discovery="<b>Discoveryᐩ: </b>未支持 🚫",void e("不支持 Discoveryᐩ"))}),(t=>{e("discovery failed")}))}else e("discovery failed")}),(t=>{e("discovery failed")}))})),new Promise(((e,t)=>{let i={url:"https://chat.openai.com/",opts:a,timeout:2800};$task.fetch(i).then((t=>{let i=JSON.stringify(t),o=i.indexOf("text/plain");if(-1==o){let t={url:"https://chat.openai.com/cdn-cgi/trace",opts:a,timeout:2800};$task.fetch(t).then((t=>{let i=t.body.split("loc=")[1].split("\n")[0],o=support_countryCodes.indexOf(i);return-1!=o?(s.ChatGPT="<b>ChatGPT: </b>支持  ➟ ⟦"+r.get(i.toUpperCase())+"⟧ 🎉",void e("支持 ChatGPT")):(s.ChatGPT="<b>ChatGPT: </b>未支持 🚫",void e("不支持 ChatGPT"))}),(t=>{e("ChatGPT failed")}))}else s.ChatGPT="<b>ChatGPT: </b>未支持 🚫",e("不支持 ChatGPT")}),(t=>{e("ChatGPT failed")}))}))]);var b;2==c?s.Disney="<b>Disneyᐩ:</b> 即将登陆 ➟ ⟦"+r.get(o.toUpperCase())+"⟧ ⚠️":1==c?s.Disney="<b>Disneyᐩ:</b> 支持 ➟ ⟦"+r.get(o.toUpperCase())+"⟧ 🎉":0==c?s.Disney="<b>Disneyᐩ:</b> 未支持 🚫 ":-1==c&&(s.Disney="<b>Disneyᐩ:</b> 检测超时 🚦 ");let p="------------------------------</br>"+[s.YouTube,s.Netflix,s.Disney,s.Dazn,s.Paramount,s.Discovery,s.ChatGPT].join("</br></br>");p=p+"</br>------------------------------</br><font color=#CD5C5C ><b>节点</b> ➟ "+$environment.params+"</font>",p='<p style="text-align: center; font-family: -apple-system; font-size: large; font-weight: thin">'+p+"</p>",$configuration.sendMessage(l).then((e=>{if(e.error&&$done(),e.ret){let t=JSON.stringify(e.ret[l.content])?JSON.stringify(e.ret[l.content]).replace(/\"|\[|\]/g,"").replace(/\,/g," ➟ "):$environment.params,i="--------------------------------------</br>"+[s.Dazn,s.Discovery,s.Paramount,s.Disney,s.ChatGPT,s.Netflix,s.YouTube].join("</br></br>");i=i+"</br>--------------------------------------</br><font color=#CD5C5C><b>节点</b> ➟ "+t+"</font>",i='<p style="text-align: center; font-family: -apple-system; font-size: large; font-weight: thin">'+i+"</p>",$done({title:s.title,htmlMessage:i})}}),(e=>{$done()}))})().finally((()=>{$configuration.sendMessage(l).then((e=>{if(e.error&&$done(),e.ret){let t=JSON.stringify(e.ret[l.content])?JSON.stringify(e.ret[l.content]).replace(/\"|\[|\]/g,"").replace(/\,/g," ➟ "):$environment.params,i="--------------------------------------</br>"+[s.Dazn,s.Discovery,s.Paramount,s.Disney,s.ChatGPT,s.Netflix,s.YouTube].join("</br></br>");i=i+"</br>--------------------------------------</br><font color=#CD5C5C><b>节点</b> ➟ "+t+"</font>",i='<p style="text-align: center; font-family: -apple-system; font-size: large; font-weight: thin">'+i+"</p>",$done({title:s.title,htmlMessage:i})}}),(e=>{$done()})),$done({title:s.title,htmlMessage:'<p style="text-align: center; font-family: -apple-system; font-size: large; font-weight: thin">----------------------</br></br>🚥 检测异常</br></br>----------------------</br>'+output+"</p>"})})),support_countryCodes=["T1","XX","AL","DZ","AD","AO","AG","AR","AM","AU","AT","AZ","BS","BD","BB","BE","BZ","BJ","BT","BA","BW","BR","BG","BF","CV","CA","CL","CO","KM","CR","HR","CY","DK","DJ","DM","DO","EC","SV","EE","FJ","FI","FR","GA","GM","GE","DE","GH","GR","GD","GT","GN","GW","GY","HT","HN","HU","IS","IN","ID","IQ","IE","IL","IT","JM","JP","JO","KZ","KE","KI","KW","KG","LV","LB","LS","LR","LI","LT","LU","MG","MW","MY","MV","ML","MT","MH","MR","MU","MX","MC","MN","ME","MA","MZ","MM","NA","NR","NP","NL","NZ","NI","NE","NG","MK","NO","OM","PK","PW","PA","PG","PE","PH","PL","PT","QA","RO","RW","KN","LC","VC","WS","SM","ST","SN","RS","SC","SL","SG","SK","SI","SB","ZA","ES","LK","SR","SE","CH","TH","TG","TO","TT","TN","TR","TV","UG","AE","US","UY","VU","ZM","BO","BN","CG","CZ","VA","FM","MD","PS","KR","TW","TZ","TL","GB"];
