// https://raw.githubusercontent.com/ElementRef/AboutConfig/main/script/ddgksf2013.red.book.js
const $=new Env("\u5C0F\u7EA2\u4E66");var _0xodK="jsjiami.com.v7";const _0x55914b=_0x1411;(function(o,c,d,e,t,s,a){return o=o>>4,s="hs",a="hs",function(i,r,n,h,l){const u=_0x1411;h="tfi",s=h+s,l="up",a+=l,s=n(s),a=n(a),n=0;const x=i();for(;--e+r;)try{h=-parseInt(u(523,"(*w$"))/1+-parseInt(u(543,")GRf"))/2*(-parseInt(u(506,"wdSI"))/3)+parseInt(u(544,"AqOX"))/4*(parseInt(u(566,")GRf"))/5)+parseInt(u(509,"92$L"))/6*(parseInt(u(556,"#KMX"))/7)+-parseInt(u(663,"]Rdr"))/8*(parseInt(u(479,"eonb"))/9)+-parseInt(u(596,"o]P6"))/10*(-parseInt(u(547,"Aopj"))/11)+parseInt(u(555,"*oS]"))/12*(-parseInt(u(630,"t)g^"))/13)}catch{h=n}finally{if(l=x[s](),o<=e)n?t?h=l:t=l:n=l;else if(n==t.replace(/[ngEGkOCtdUMJheVPAKXlx=]/g,"")){if(h===r){x["un"+s](l);break}x[a](l)}}}(d,c,function(i,r,n,h,l,u,x){return r="split",i=arguments[0],i=i[r](""),n="reverse",i=i[n]("v"),h="join",i[h]("")})})(3136,595808,_0x3711,198),_0x3711&&(_0xodK="]c");$[_0x55914b(568,"]Rdr")]=_0x55914b(664,"%@KA"),$[_0x55914b(599,"KKJz")]="redbook_user_video_key";function _0x1411(o,c){const d=_0x3711();return _0x1411=function(e,t){e=e-462;let s=d[e];if(_0x1411.AhGqse===void 0){var a=function(l){const u="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=";let x="",f="";for(let S=0,p,W,k=0;W=l.charAt(k++);~W&&(p=S%4?p*64+W:W,S++%4)?x+=String.fromCharCode(255&p>>(-2*S&6)):0)W=u.indexOf(W);for(let S=0,p=x.length;S<p;S++)f+="%"+("00"+x.charCodeAt(S).toString(16)).slice(-2);return decodeURIComponent(f)};const h=function(l,u){let x=[],f=0,S,p="";l=a(l);let W;for(W=0;W<256;W++)x[W]=W;for(W=0;W<256;W++)f=(f+x[W]+u.charCodeAt(W%u.length))%256,S=x[W],x[W]=x[f],x[f]=S;W=0,f=0;for(let k=0;k<l.length;k++)W=(W+1)%256,f=(f+x[W])%256,S=x[W],x[W]=x[f],x[f]=S,p+=String.fromCharCode(l.charCodeAt(k)^x[(x[W]+x[f])%256]);return p};_0x1411.ZftWrw=h,o=arguments,_0x1411.AhGqse=!0}const i=d[0],r=e+i,n=o[r];return n?s=n:(_0x1411.yDzVOH===void 0&&(_0x1411.yDzVOH=!0),s=_0x1411.ZftWrw(s,t),o[r]=s),s},_0x1411(o,c)}let body=$response.body;function _0x3711(){const o=function(){return[_0xodK,"CAjAskPjinXalmMhhiJt.EGcUxoKgmkn.Vdnve7O==","5Pom57Ap56Yl6kYo","WOFcHv8FrCk6cZzyW6HKW7fWWQSaDaO","W6ddLSkTWQKNWR3dTSor","aCknWQNcQwi","W7ddVSk8WQJdLZxcUWi","CMpdGvhcJ38IECkGWQa","W6hdPxrnfSkSlGBcOSopz8k5","vJpcMYSSWQpcI8ozW4eQWOjGWOVdSdNcLSo3D8oFjSo5nq","W4e/W5OWumoYW6vnWOvIWRe","fmowW5pdKZxcTrhcM8oA","W6ZdItu","FWBcLvyv","WRlcLglcI8o6WRxcJCoDW7VcOG","y8oYqG","WRNdGh7dMCocW7FdNCkMWO3cLmkh","t8kWqmoU","WPNcLeKtrCki","W41kW6Gv","W6ldMSkIWRWMWQRdT8o9W79IlSk0WOmLc8kEoW","WRtdJgVdNW","rZFcIYWKWQpcKSoVW5eQW50Y","fCoHW4lcHt8qa8ocW58","WObSsaCUhSodW7e","zmkvaSo/bIdcP0JdJq","qqPhF8oTCMhcJSk2kmomn8o6xh1nuq","eSoWW4pcMa","CsCD","mbBdIq","W6Dej1n8tHPzzK9caCofW4S","wConWPK","W5NcICoB","lMNdHq","heyIWRhcKSkbcgpcG2zj","W7vmn1C","pqCWWR/dJSkXmG","qqtcKq","dSo6W53cItCsd8oaWPXS","dIdcLmkblmkuW6qDdq","W4mZW40H","WQFcPtyss8o5iJJcSG","BCoaWR7dJCoHW5DQeW","mCkmWPFdH8ouA0BcIehdRJRdKtKVfCkIW5a","WRrYCa","mJNcKHdcMLCVFCkKWRW","CCkreSofhHdcVeG","kmo/W6JcVCo0WQfNFIbHzh5v","eZtcLYdcKgCTrCkRWRFdRJ7dNh52","sComWR7dQSoHW6DOjXfouCoRBSkMiG","WQtcSdyiqa","bmkbWQpcTdLy","WPRcGuKfqq","W51oW68a","ft3cImkChCkeW6ijeda","i2ldKq","aCk5WQJcOsVdIanDiGJdPmkTWOvuCmkG","qH/cMveXW5FdLKevAW0","cCoNW5NcIZGznCorW5qG","aSo0W4tcJq","W6SiiW","e8onW4ldMXK","WOfcW6hdRmk5hSkuamkp","xCoDW7NdUhu6pCkgWPhdQW","WP5QxXyeamopW7fg","FCoCWRtdI8o6W6fSgszes8oWv8kQpSkt","WPyPW7CeluxdTW","W7/cG8ooWO0bW6eMlfa","W6ddNSk8WQ43","pr3dNCkJb2e1WOudpW","WPDyW7FdMSkJemkqaW","BWNdICo5W53dGCkYW74l"].concat(function(){return["hSoufCkduSkdWPRdLSkaWRKwfHGQaG","dWdcQYpdOGVdR8kkW4NcGY7dNG","fSowW4a","DmolWPeDWQe","yCkrgSoflIBcSq","DCogWQ7dJCorW6zMdW1+vSoWqmkZ","a10XWRZcLCkibLRcKW","BCoaWR7dJCoHWRiJ","DJtcGmkaW7pcSbrJaSk1W4Pz","xbNcKfe4W63dGfvEyGddMmk8","W71bWRBcMCknW501emo6W5O","W6jaWQhcJSk3W7i0eCoOW5O","v8kGWOtdLcC1aCopW58l","W7JdNSk9WOiGWQRdV8odW6XOjCkpWPCvcSkpjq","hSoyW5pdLW","d8olW4S","DSomWRFdJCorW7HIfbjaqSoH","D8kzbmotfa","W5mItMuX","W6hcKSoyWO0o","omouaSk1","W4qdW6Gh","WQldIhpdN8otW7tdNmkCWO7dGCoiqtrTWOhdIhu","WQizC0zwysTqEW","zCo0xmo0W6akWO3dMh8","f8oCW4RdKZxcQrNcI8ofW4JcH2G","wbNcMG","i8kFW6RcNCk9WRG7lIHIxmoota","q8o5W6ldOsddNqXVmGa","WRlcKMhcHSoYW6ldK8kSWQldNSo1","W7bcW6XHDcJdMGhdOYu","oSoyfCkKuSkZWPFdO8knWRiagdaK","a8k0eWCJAI/dKsBcIW","EmogWRFdHCoRW6z3ba","cWdcUI7dKrldOmknW4NcS2dcN8oi","WReaWRa4pNBcTLtcUNO1dx0dWRu","W68gn0/dPqWDC8oiWOxcGSkXDHu3nqy","W58az8oXW6VdGeZdJmkvpWavyuldL8ogEeu","W417fYtdJW","vqbzw8o4Dg0","deddJqfTWRJcNwGHtrddPmkW","DwldHLddIdL/vmkeWP7dVrddGa","BSomhG","W7tdNSk6WRW","W5CizCo1","W4iMW6uHaa","geGWWORcICkka13cNM5kdGf3j3zg","mwfbW6tcUmobhr3dHCoJzhq","fSkHWQ/cTa","5PkR57w0566Q6k+L","CuhcNSoCl8k2l8otDsa","qCo0W6VcPqVdLqLilq","zfZcJCoDl8kSnCooFtFdS21jq8kVDWfwW6z2W6zInIpdOCoudZGPi+AsRoE2PoETREIUN20h","WOBcTca5sSoXia7cO8oSvCkVW6xdLhK","WP/cKLC","bWBcQIJdKrtdPSkbW6lcMwBcKG","WPG3huy","j2ZdHCoNWRpdRtPneCk/W7r8dCoOpCk9yG","u8k0qmofWOuLDCopWO5DWRhcRdvLW6SSpa","wSonWOSiWOtcLmkDWRdcTeu","W49ZdZhdMsm","W6zGWRhdQmokW5GYW5Xi","uHpcMfbKWQG","W5XOdW","uJ/cMYWSWPpcHSoJW5e9WOvZWRFdQW","W5T/dYtdIdtdO3JdKmo/WOldJCoLemkeeSkO","W7HfWQhcM8k3W54ce8oNW4zj","WQ8vWRGWlehcMLBcO3emb3vxW7pcRCkr","W4BcJSoDWQlcMXRcOmoWzSol","ttVcNI4MWPpcLCo0W5G","imoEfG","ESoVsq"].concat(function(){return["A8kvWQzcebhcVCk2W5a","C8kDbCou","W6rAWQW","aSkHWQNcPIS","W70MW7xcTa","W7NcHCoq","oCodhq","WPiKu3KWgSoeW5BdPCkHnmk8gGy","mJtcKHdcNgbPFCkTWQFdRIlcRtS","WR7dJ8koW5DFW6iFi1RcLSkl","amoGW57cJYuEbCokW7KPEcpcNrKpW70","q8oYu109EIldNt0","W6emDCowW5VdN0/dTCkindOCq0VdIW","W6DbWQtcMCk9W7i5emo5W5TrW5tdOmkt","mtdcGrhcMG","W6zej1f2zq0mmq","fwBdKmoD","cmkjWRNcOq","WQmaWQWgoxBcJfRcSa","WQpdMw3dL8ojW7BdKCkLWPa","laZdNCku","WOuIESo2W7ddU1u","CSohqmoyW6S","rWlcJ10WW6/dJfCj","hSkVWRW","rH1h","eqZcSsFdIr7dO8k6W5RcG3VcMSozBdr2W5G","W6BdTCkSWPpdGIJcTW","W7Xij19YtG1xz0rXdColW4hdQmoIW6e","smkHuSoUWOiZ","oCoZW6lcVCoPWP96DrLNvMKaBa","WRirWQ4Qka","AComWQRdH8o8W7W","W40hW7Gpca","WOb9W5OmFSkPWOq","cmkPaCoMW4C8lCosW4S","W5uaFCoGW5hdGG","W5q5W44SymobW79tWOS","CCkvWRfgdq","bWJcQsC","A8oiWQJdM8oR","vJpcKYG3WQNcHmozW5m2WOH2WQFdNZ/cJmoU","WQmzCaiRCXb3FMXj","cSoMCmowWR0zESoN","W5ZcI8oDWRFcMXRcVmoSBa","ustcKW","W6xdSCkQWOtdHG","F8oFbSkH","nbJdNCkJeNy2WPehkCkscmkIgHZcSwG","WRJdJgZdOCovW7tdLmkIWP3dI8odEIbDWOddMwS","hmkjWR/cS2y","dSo0W4pcSYmsbSofW5iPCGJcIb8fW6P1","kCkgqmoZotqPm8oRkZC","ztec","W5aZuh8G","WRvLBZW","amo6W4lcQtauaG","nwyYWP7dGCkQgWW","W4CIshC","omkiWOFdJW","stpcMYaIWPpcK8oNW4i8WRHXWRVdRJFcKmoK","dGZcUs/dNctdTmkeW4VcIuVcNCofxtXQW5i","CSoAWOxdICoQW7S","kt7cNGFcMw0JD8oSWQddOZ7dPW","cthcLCkC","mSo5W6S","qW5zBCo8","W6hcKSorWOeWW7yUkulcPmkVW78","v8kSWONdMd8poSoLW5m2","WPJcHuSzvSkr"]}())}())}();return _0x3711=function(){return o},_0x3711()}if(body){switch(!0){case/api\/sns\/v\d\/note\/widgets/.test($request[_0x55914b(487,"Ulyg")]):try{let o=JSON[_0x55914b(511,"8SWs")](body);const c=[_0x55914b(594,"sRy2"),_0x55914b(520,"F1V&")];for(const d of c)o[_0x55914b(464,"y$29")]?.[d]&&delete o.data[d];body=JSON[_0x55914b(484,"]Rdr")](o)}catch{}break;case/api\/sns\/v\d\/note\/live_photo\/save/[_0x55914b(651,"]Nbi")]($request[_0x55914b(670,"PZxd")]):try{let o=JSON[_0x55914b(493,"]Rdr")](body);o[_0x55914b(646,"OLE1")][_0x55914b(553,"05])")]=JSON.parse($.getdata($[_0x55914b(515,"&)pI")])),body=JSON[_0x55914b(521,"Oo4A")](o)}catch{}break;case/api\/sns\/v\d\/note\/video\/save/.test($request.url):try{let o=JSON[_0x55914b(618,"1K[3")](body);o.data=JSON[_0x55914b(633,"VfSZ")]($.getdata($.RedBookVideoKey)),body=JSON[_0x55914b(505,"]W[4")](o)}catch{}break;case/api\/sns\/v\d\/note\/comment\/list/.test($request[_0x55914b(589,"t^R5")]):try{let o=JSON.parse(body);for(let c of o[_0x55914b(563,")GRf")][_0x55914b(548,"F1V&")])if(c[_0x55914b(467,"DFkF")])for(let d of c[_0x55914b(659,"8SWs")])d[_0x55914b(540,"5)I5")]?.[_0x55914b(584,"%@KA")]&&(d[_0x55914b(501,"ymNm")]=d[_0x55914b(531,"F1V&")].image_url,d[_0x55914b(612,"o20d")]=d[_0x55914b(654,"o]P6")][_0x55914b(631,"N@1G")]);body=JSON[_0x55914b(482,"]Nbi")](o)}catch{}break;case/api\/sns\/v\d\/note\/redtube/[_0x55914b(483,"FA#Z")]($request.url):try{let o=JSON.parse(body);for(let c of o[_0x55914b(496,"UDVR")].items)c[_0x55914b(628,"%@KA")]&&(c[_0x55914b(537,"y$29")]=0),c[_0x55914b(551,"LfM&")]&&(c[_0x55914b(528,"8SWs")]=!1),c[_0x55914b(648,"%^L*")]&&(c[_0x55914b(647,"%@KA")]={disable_save:!1,disable_watermark:!0,disable_weibo_cover:!0}),c[_0x55914b(583,"N@1G")]&&(c[_0x55914b(526,"t^R5")][_0x55914b(508,"F1V&")]=[{type:_0x55914b(600,"t^R5")},{type:_0x55914b(617,"wBoq")},{type:"copy_link"},{type:"native_voice"},{type:_0x55914b(665,"FA#Z")},{type:"dislike"},{type:_0x55914b(619,"F1V&")},{type:_0x55914b(579,"%@KA")}]);body=JSON.stringify(o)}catch{}break;case/api\/sns\/v\d\/note\/videofeed/.test($request[_0x55914b(593,"&)pI")]):try{let o=JSON[_0x55914b(590,")GRf")](body),c={};for(let d of o[_0x55914b(559,"KKJz")]){const e=_0x55914b(622,"t)g^")[_0x55914b(641,"sRy2")]("|");let t=0;for(;;){switch(e[t++]){case"0":d.media_save_config&&(d[_0x55914b(582,"1K[3")]={disable_save:!1,disable_watermark:!0,disable_weibo_cover:!0});continue;case"1":d[_0x55914b(490,"wBoq")]?.[_0x55914b(534,"o]P6")]?.[_0x55914b(591,"mi7x")]&&(c[_0x55914b(616,"t)g^")]="2",c.note_id=d.id,c[_0x55914b(570,"%^L*")]=d.video_info_v2[_0x55914b(660,"wdSI")][_0x55914b(603,"]Nbi")][0].master_url);continue;case"2":d[_0x55914b(572,"(*w$")]&&(d[_0x55914b(635,")5qj")]=!1);continue;case"3":d.related_goods_num&&(d.related_goods_num=0);continue;case"4":d[_0x55914b(488,"#KMX")]&&(d.share_info[_0x55914b(597,"ymNm")]=[{type:_0x55914b(473,"6hos")},{type:"generate_image"},{type:_0x55914b(624,"FA#Z")},{type:"native_voice"},{type:_0x55914b(500,"*oS]")},{type:"dislike"},{type:_0x55914b(656,"eCfz")},{type:_0x55914b(546,"&)pI")}]);continue}break}}$[_0x55914b(614,"VfSZ")](JSON[_0x55914b(576,"mi7x")](c),$[_0x55914b(491,"#KMX")]),body=JSON.stringify(o)}catch{}break;case/api\/sns\/v\d\/note\/feed/[_0x55914b(535,"&)pI")]($request[_0x55914b(578,"05])")]):try{let o=JSON[_0x55914b(533,"sRy2")](body);for(let c of o.data)if(c[_0x55914b(469,"o20d")]&&(c[_0x55914b(580,"05])")]=0),c[_0x55914b(573,"t)g^")]&&(c[_0x55914b(636,"y$29")]=!1),c.note_list)for(let d of c[_0x55914b(507,"DFkF")])d[_0x55914b(658,"eCfz")]={disable_save:!1,disable_watermark:!0,disable_weibo_cover:!0};body=JSON[_0x55914b(610,"*oS]")](o)}catch{}break;case/api\/sns\/v\d\/note\/imagefeed/[_0x55914b(588,"JhIG")]($request[_0x55914b(592,"o]P6")]):try{let o=JSON[_0x55914b(495,"eCfz")](body),c=[];for(let d of o.data)if(d[_0x55914b(463,"8SWs")]&&(d[_0x55914b(613,"%^L*")]=0),d[_0x55914b(638,"ymNm")]&&(d[_0x55914b(561,"Oo4A")]=!1),d.note_list){for(let e of d[_0x55914b(666,"5)I5")])if(e[_0x55914b(486,"OLE1")]={disable_save:!1,disable_watermark:!0,disable_weibo_cover:!0},e[_0x55914b(581,"t^R5")]){for(let t of e.images_list)if(t[_0x55914b(574,"(4u!")]){let s={};s[_0x55914b(485,"F1V&")]=t[_0x55914b(525,"t^R5")][_0x55914b(660,"wdSI")][_0x55914b(489,"JhIG")],s[_0x55914b(519,"JhIG")]=t[_0x55914b(552,"KKJz")],s[_0x55914b(612,"o20d")]=t.live_photo[_0x55914b(620,"92$L")][_0x55914b(673,"eCfz")][_0x55914b(571,"DFkF")][0].master_url,c[_0x55914b(607,")5qj")](s)}}}$.setdata(JSON.stringify(c),$[_0x55914b(492,"F1V&")]),body=JSON[_0x55914b(587,"rmqJ")](o)}catch{}break;case/api\/sns\/v\d\/homefeed\/categories\?/[_0x55914b(642,"Ulyg")]($request[_0x55914b(670,"PZxd")]):try{let o=JSON[_0x55914b(627,"F1V&")](body);o[_0x55914b(536,"92$L")].categories=o[_0x55914b(529,"5)I5")].categories[_0x55914b(575,"05])")](c=>!(c.oid==_0x55914b(650,"#KMX")||c[_0x55914b(474,"(4u!")]==_0x55914b(524,"*oS]"))),body=JSON[_0x55914b(576,"mi7x")](o)}catch{}break;case/api\/sns\/v\d\/search\/hint/[_0x55914b(672,"t)g^")]($request[_0x55914b(569,"eCfz")]):try{let o=JSON[_0x55914b(601,"#KMX")](body);o.data?.hint_words&&(o.data[_0x55914b(497,"]Nbi")]=[{title:_0x55914b(564,"FA#Z"),type:_0x55914b(567,"0%ii"),search_word:_0x55914b(657,"y$29")}]),body=JSON[_0x55914b(598,"Aopj")](o)}catch{}break;case/api\/sns\/v\d\/search\/hot_list/.test($request[_0x55914b(557,"3cb9")]):try{let o=JSON[_0x55914b(532,"JhIG")](body);o[_0x55914b(634,"3cb9")]={scene:"",title:"",items:[],host:"",background_color:{},word_request_id:""},body=JSON[_0x55914b(466,"ymNm")](o)}catch{}break;case/api\/sns\/v\d\/search\/trending/[_0x55914b(588,"JhIG")]($request[_0x55914b(530,"5)I5")]):try{let o=JSON.parse(body);o[_0x55914b(626,"%^L*")]={title:"",queries:[],type:"",word_request_id:""},body=JSON[_0x55914b(539,"PZxd")](o)}catch{}break;case/api\/sns\/v\d\/system_service\/splash_config/[_0x55914b(462,"UDVR")]($request[_0x55914b(632,"%@KA")]):try{let o=JSON.parse(body);o[_0x55914b(502,"ymNm")][_0x55914b(512,")5qj")][_0x55914b(643,"ymNm")](c=>{const d=_0x55914b,e={UeHJJ:d(514,"UXhI"),dGnEe:function(t,s){return t!==s},KphbK:"bDyGi",Bolpz:d(545,"1K[3"),pEDDb:d(669,"AqOX")};c.start_time=e[d(518,"(4u!")],c[d(661,"VfSZ")]=e.pEDDb,c[d(640,"eonb")]&&c[d(476,"(*w$")][d(554,"o20d")](t=>{const s=d;if(e[s(609,"PZxd")](e[s(668,"*oS]")],s(560,"92$L")))for(let a of _0x203a61[e.UeHJJ])a[s(615,"6hos")]={disable_save:!1,disable_watermark:!0,disable_weibo_cover:!0};else t[s(565,"0%ii")]=e.Bolpz,t[s(513,"]W[4")]=e.pEDDb})}),body=JSON.stringify(o)}catch{}break;case/api\/sns\/v\d\/homefeed\?/[_0x55914b(470,"ymNm")]($request[_0x55914b(589,"t^R5")]):try{let o=JSON[_0x55914b(637,"wdSI")](body);o[_0x55914b(478,"6hos")]=o[_0x55914b(604,"wdSI")].filter(c=>!c[_0x55914b(649,"F1V&")]),body=JSON[_0x55914b(606,"y$29")](o)}catch{}break;case/api\/sns\/v\d+\/search\/notes\?/.test($request[_0x55914b(471,"eonb")]):try{let o=JSON[_0x55914b(653,"o20d")](body);o[_0x55914b(645,"sRy2")][_0x55914b(504,"5)I5")]=o.data[_0x55914b(625,"rmqJ")][_0x55914b(623,"KKJz")](c=>!c.ads),body=JSON.stringify(o)}catch{}break;case/api\/sns\/v\d\/system_service\/config\?/.test($request[_0x55914b(480,"*oS]")]):try{let o=JSON.parse(body);const c=["store","splash",_0x55914b(477,"Oo4A"),_0x55914b(605,"1K[3"),_0x55914b(468,"JhIG"),_0x55914b(549,"%^L*")];for(const d of c)o[_0x55914b(558,"8SWs")]?.[d]&&delete o[_0x55914b(626,"%^L*")][d];body=JSON[_0x55914b(510,"o]P6")](o)}catch{}break;default:$done({});break}$done({body})}else $done({});function Env(o,c){typeof process<"u"&&JSON.stringify(process.env).indexOf("GITHUB")>-1&&process.exit(0);class d{constructor(t){this.env=t}send(t,s="GET"){t=typeof t=="string"?{url:t}:t;let a=this.get;return s==="POST"&&(a=this.post),new Promise((i,r)=>{a.call(this,t,(n,h,l)=>{n?r(n):i(h)})})}get(t){return this.send.call(this.env,t)}post(t){return this.send.call(this.env,t,"POST")}}return new class{constructor(e,t){this.name=e,this.http=new d(this),this.data=null,this.dataFile="box.dat",this.logs=[],this.isMute=!1,this.isNeedRewrite=!1,this.logSeparator=`
`,this.startTime=new Date().getTime(),Object.assign(this,t)}isNode(){return typeof module<"u"&&!!module.exports}isQuanX(){return typeof $task<"u"}isSurge(){return typeof $httpClient<"u"&&typeof $loon>"u"}isLoon(){return typeof $loon<"u"}toObj(e,t=null){try{return JSON.parse(e)}catch{return t}}toStr(e,t=null){try{return JSON.stringify(e)}catch{return t}}getjson(e,t){let s=t;if(this.getdata(e))try{s=JSON.parse(this.getdata(e))}catch{}return s}setjson(e,t){try{return this.setdata(JSON.stringify(e),t)}catch{return!1}}getScript(e){return new Promise(t=>{this.get({url:e},(s,a,i)=>t(i))})}runScript(e,t){return new Promise(s=>{let a=this.getdata("@chavy_boxjs_userCfgs.httpapi");a=a&&a.replace(/\n/g,"").trim();let i=this.getdata("@chavy_boxjs_userCfgs.httpapi_timeout");i=i?1*i:20,i=t&&t.timeout?t.timeout:i;const[r,n]=a.split("@"),h={url:`http://${n}/v1/scripting/evaluate`,body:{script_text:e,mock_type:"cron",timeout:i},headers:{"X-Key":r,Accept:"*/*"}};this.post(h,(l,u,x)=>s(x))}).catch(s=>this.logErr(s))}loaddata(){if(!this.isNode())return{};{this.fs=this.fs?this.fs:require("fs"),this.path=this.path?this.path:require("path");const e=this.path.resolve(this.dataFile),t=this.path.resolve(process.cwd(),this.dataFile),s=this.fs.existsSync(e),a=!s&&this.fs.existsSync(t);if(!s&&!a)return{};{const i=s?e:t;try{return JSON.parse(this.fs.readFileSync(i))}catch{return{}}}}}writedata(){if(this.isNode()){this.fs=this.fs?this.fs:require("fs"),this.path=this.path?this.path:require("path");const e=this.path.resolve(this.dataFile),t=this.path.resolve(process.cwd(),this.dataFile),s=this.fs.existsSync(e),a=!s&&this.fs.existsSync(t),i=JSON.stringify(this.data);s?this.fs.writeFileSync(e,i):a?this.fs.writeFileSync(t,i):this.fs.writeFileSync(e,i)}}lodash_get(e,t,s){const a=t.replace(/\[(\d+)\]/g,".$1").split(".");let i=e;for(const r of a)if(i=Object(i)[r],i===void 0)return s;return i}lodash_set(e,t,s){return Object(e)!==e||(Array.isArray(t)||(t=t.toString().match(/[^.[\]]+/g)||[]),t.slice(0,-1).reduce((a,i,r)=>Object(a[i])===a[i]?a[i]:a[i]=Math.abs(t[r+1])>>0==+t[r+1]?[]:{},e)[t[t.length-1]]=s),e}getdata(e){let t=this.getval(e);if(/^@/.test(e)){const[,s,a]=/^@(.*?)\.(.*?)$/.exec(e),i=s?this.getval(s):"";if(i)try{const r=JSON.parse(i);t=r?this.lodash_get(r,a,""):t}catch{t=""}}return t}setdata(e,t){let s=!1;if(/^@/.test(t)){const[,a,i]=/^@(.*?)\.(.*?)$/.exec(t),r=this.getval(a),n=a?r==="null"?null:r||"{}":"{}";try{const h=JSON.parse(n);this.lodash_set(h,i,e),s=this.setval(JSON.stringify(h),a)}catch{const l={};this.lodash_set(l,i,e),s=this.setval(JSON.stringify(l),a)}}else s=this.setval(e,t);return s}getval(e){return this.isSurge()||this.isLoon()?$persistentStore.read(e):this.isQuanX()?$prefs.valueForKey(e):this.isNode()?(this.data=this.loaddata(),this.data[e]):this.data&&this.data[e]||null}setval(e,t){return this.isSurge()||this.isLoon()?$persistentStore.write(e,t):this.isQuanX()?$prefs.setValueForKey(e,t):this.isNode()?(this.data=this.loaddata(),this.data[t]=e,this.writedata(),!0):this.data&&this.data[t]||null}initGotEnv(e){this.got=this.got?this.got:require("got"),this.cktough=this.cktough?this.cktough:require("tough-cookie"),this.ckjar=this.ckjar?this.ckjar:new this.cktough.CookieJar,e&&(e.headers=e.headers?e.headers:{},e.headers.Cookie===void 0&&e.cookieJar===void 0&&(e.cookieJar=this.ckjar))}get(e,t=()=>{}){e.headers&&(delete e.headers["Content-Type"],delete e.headers["Content-Length"]),this.isSurge()||this.isLoon()?(this.isSurge()&&this.isNeedRewrite&&(e.headers=e.headers||{},Object.assign(e.headers,{"X-Surge-Skip-Scripting":!1})),$httpClient.get(e,(s,a,i)=>{!s&&a&&(a.body=i,a.statusCode=a.status),t(s,a,i)})):this.isQuanX()?(this.isNeedRewrite&&(e.opts=e.opts||{},Object.assign(e.opts,{hints:!1})),$task.fetch(e).then(s=>{const{statusCode:a,statusCode:i,headers:r,body:n}=s;t(null,{status:a,statusCode:i,headers:r,body:n},n)},s=>t(s))):this.isNode()&&(this.initGotEnv(e),this.got(e).on("redirect",(s,a)=>{try{if(s.headers["set-cookie"]){const i=s.headers["set-cookie"].map(this.cktough.Cookie.parse).toString();i&&this.ckjar.setCookieSync(i,null),a.cookieJar=this.ckjar}}catch(i){this.logErr(i)}}).then(s=>{const{statusCode:a,statusCode:i,headers:r,body:n}=s;t(null,{status:a,statusCode:i,headers:r,body:n},n)},s=>{const{message:a,response:i}=s;t(a,i,i&&i.body)}))}post(e,t=()=>{}){if(e.body&&e.headers&&!e.headers["Content-Type"]&&(e.headers["Content-Type"]="application/x-www-form-urlencoded"),e.headers&&delete e.headers["Content-Length"],this.isSurge()||this.isLoon())this.isSurge()&&this.isNeedRewrite&&(e.headers=e.headers||{},Object.assign(e.headers,{"X-Surge-Skip-Scripting":!1})),$httpClient.post(e,(s,a,i)=>{!s&&a&&(a.body=i,a.statusCode=a.status),t(s,a,i)});else if(this.isQuanX())e.method="POST",this.isNeedRewrite&&(e.opts=e.opts||{},Object.assign(e.opts,{hints:!1})),$task.fetch(e).then(s=>{const{statusCode:a,statusCode:i,headers:r,body:n}=s;t(null,{status:a,statusCode:i,headers:r,body:n},n)},s=>t(s));else if(this.isNode()){this.initGotEnv(e);const{url:s,...a}=e;this.got.post(s,a).then(i=>{const{statusCode:r,statusCode:n,headers:h,body:l}=i;t(null,{status:r,statusCode:n,headers:h,body:l},l)},i=>{const{message:r,response:n}=i;t(r,n,n&&n.body)})}}time(e,t=null){const s=t?new Date(t):new Date;let a={"M+":s.getMonth()+1,"d+":s.getDate(),"H+":s.getHours(),"m+":s.getMinutes(),"s+":s.getSeconds(),"q+":Math.floor((s.getMonth()+3)/3),S:s.getMilliseconds()};/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(s.getFullYear()+"").substr(4-RegExp.$1.length)));for(let i in a)new RegExp("("+i+")").test(e)&&(e=e.replace(RegExp.$1,RegExp.$1.length==1?a[i]:("00"+a[i]).substr((""+a[i]).length)));return e}msg(e=o,t="",s="",a){const i=r=>{if(!r)return r;if(typeof r=="string")return this.isLoon()?r:this.isQuanX()?{"open-url":r}:this.isSurge()?{url:r}:void 0;if(typeof r=="object"){if(this.isLoon()){let n=r.openUrl||r.url||r["open-url"],h=r.mediaUrl||r["media-url"];return{openUrl:n,mediaUrl:h}}if(this.isQuanX()){let n=r["open-url"]||r.url||r.openUrl,h=r["media-url"]||r.mediaUrl;return{"open-url":n,"media-url":h}}if(this.isSurge())return{url:r.url||r.openUrl||r["open-url"]}}};if(this.isMute||(this.isSurge()||this.isLoon()?$notification.post(e,t,s,i(a)):this.isQuanX()&&$notify(e,t,s,i(a))),!this.isMuteLog){let r=[""];r.push(e),t&&r.push(t),s&&r.push(s),this.logs=this.logs.concat(r)}}log(...e){e.length>0&&(this.logs=[...this.logs,...e])}logErr(e,t){!this.isSurge()&&!this.isQuanX()&&!this.isLoon()?this.log("",`\u2757\uFE0F${this.name}, \u9519\u8BEF!`,e.stack):this.log("",`\u2757\uFE0F${this.name}, \u9519\u8BEF!`,e)}wait(e){return new Promise(t=>setTimeout(t,e))}done(e={}){const t=new Date().getTime(),s=(t-this.startTime)/1e3;(this.isSurge()||this.isQuanX()||this.isLoon())&&$done(e)}}(o,c)}
