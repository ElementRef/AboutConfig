// Mon Jun 23 2025 21:21:48 GMT+0000 (Coordinated Universal Time) https://raw.githubusercontent.com/ElementRef/AboutConfig/main/script/ddgksf2013.weibo.js
const version="V2.0.136",mainConfig={isDebug:!1,author:"ddgksf2013",removeHomeVip:!0,removeHomeCreatorTask:!0,removeRelate:!0,removeGood:!0,removeFollow:!0,modifyMenus:!0,removeRelateItem:!1,removeRecommendItem:!0,removeRewardItem:!0,removeLiveMedia:!0,removeNextVideo:!1,removePinedTrending:!0,removeInterestFriendInTopic:!1,removeInterestTopic:!1,removeInterestUser:!0,removeLvZhou:!0,removeSearchWindow:!0,profileSkin1:null,profileSkin2:null,tabIconVersion:0,tabIconPath:""},itemMenusConfig={creator_task:!1,mblog_menus_custom:!1,mblog_menus_video_later:!0,mblog_menus_comment_manager:!0,mblog_menus_avatar_widget:!1,mblog_menus_card_bg:!1,mblog_menus_long_picture:!0,mblog_menus_delete:!0,mblog_menus_edit:!0,mblog_menus_edit_history:!0,mblog_menus_edit_video:!0,mblog_menus_sticking:!0,mblog_menus_open_reward:!0,mblog_menus_novelty:!1,mblog_menus_favorite:!0,mblog_menus_promote:!0,mblog_menus_modify_visible:!0,mblog_menus_copy_url:!0,mblog_menus_follow:!0,mblog_menus_video_feedback:!0,mblog_menus_shield:!0,mblog_menus_report:!0,mblog_menus_apeal:!0,mblog_menus_home:!0},modifyCardsUrls=["/cardlist","video/community_tab","searchall"],modifyStatusesUrls=["statuses/friends/timeline","statuses_unread_hot_timeline","statuses/unread_friends_timeline","statuses/unread_hot_timeline","groups/timeline","statuses/friends_timeline"],otherUrls={"/profile/me":"removeHome","/statuses/extend":"itemExtendHandler","/video/remind_info":"removeVideoRemind","/checkin/show":"removeCheckin","/live/media_homelist":"removeMediaHomelist","/comments/build_comments":"removeComments","/container/get_item":"containerHandler","/profile/container_timeline":"userHandler","/video/tiny_stream_video_list":"nextVideoHandler","/2/statuses/video_mixtimeline":"nextVideoHandler","video/tiny_stream_mid_detail":"nextVideoHandler","/!/client/light_skin":"tabSkinHandler","/littleskin/preview":"skinPreviewHandler","/search/finder":"removeSearchMain","/search/container_timeline":"removeSearch","/search/container_discover":"removeSearch","/2/messageflow":"removeMsgAd","/2/page?":"removePage","/statuses/unread_topic_timeline":"topicHandler","/square&pageDataType/":"squareHandler","/statuses/container_timeline_topic":"removeMain","/statuses/container_timeline":"removeMainTab","wbapplua/wbpullad.lua":"removeLuaScreenAds","interface/sdk/sdkad.php":"removePhpScreenAds","a=trends":"removeTopics",user_center:"modifiedUserCenter","a=get_coopen_ads":"removeIntlOpenAds","php?a=search_topic":"removeSearchTopic","ad/realtime":"removeRealtimeAd","ad/preload":"removeAdPreload","php?a=open_app":"removeAdBanner"};function getModifyMethod(e){for(const o of modifyCardsUrls)if(-1<e.indexOf(o))return"removeCards";for(const o of modifyStatusesUrls)if(-1<e.indexOf(o))return"removeTimeLine";for(const[o,t]of Object.entries(otherUrls))if(-1<e.indexOf(o))return t;return null}function removeRealtimeAd(e){return delete e.ads,e.code=4016,e}function removeAdBanner(e){return e.data.close_ad_setting&&delete e.data.close_ad_setting,e.data.detail_banner_ad&&(e.data.detail_banner_ad=[]),e}function removeAdPreload(e){if(!e.ads)return e;e.last_ad_show_interval=86400;for(let o of e.ads)o.start_time=2681574400,o.end_time=2681660799,o.display_duration=0,o.daily_display_cnt=0,o.total_display_cnt=0;return e}function removeIntlOpenAds(e){return e.data&&(e.data={display_ad:1}),e}function removeSearchTopic(e){return e.data&&e.data.search_topic?.cards.length!==0&&(e.data.search_topic.cards=Object.values(e.data.search_topic.cards).filter(o=>o.type!="searchtop"),e.data.trending_topic&&delete e.data.trending_topic),e}function modifiedUserCenter(e){return e.data&&e.data.length!==0&&e.data.cards&&(e.data.cards=Object.values(e.data.cards).filter(o=>o.items[0].type!="personal_vip")),e}function removeTopics(e){return e.data&&(e.data.order=["search_topic"]),e}function isAd(e){return!!e&&(!(e.mblogtypename!="\u5E7F\u544A"&&e.mblogtypename!="\u70ED\u63A8")||e.promotion?.type=="ad"||e.page_info?.actionlog?.source=="ad"||e.content_auth_info?.content_auth_title=="\u5E7F\u544A")}function squareHandler(e){return e.items,e}function removeMainTab(e){if(e.loadedInfo&&e.loadedInfo.headers&&delete e.loadedInfo.headers,!e.items)return e;let o=[];for(let t of e.items)isAd(t.data)||(t.data?.page_info?.video_limit&&delete t.data.page_info.video_limit,t.data?.common_struct&&delete t.data.common_struct,t.category&&t.category=="group"?JSON.stringify(t.items).indexOf("profile_top")!=-1&&o.push(t):o.push(t));return e.items=o,log("removeMainTab success"),e}function removeMain(e){if(e.loadedInfo&&e.loadedInfo.headers&&delete e.loadedInfo.headers,!e.items)return e;let o=[];for(let t of e.items)if(t.category=="feed")isAd(t.data)||o.push(t);else if(t.category=="group")if(0<t.items.length&&t.items[0].data?.itemid?.includes("search_input"))t.items=t.items.filter(i=>i?.data?.itemid?.includes("mine_topics")||i?.data?.itemid?.includes("search_input")||i?.data?.card_type==202),t.items[0].data.hotwords=[{word:"\u641C\u7D22\u8D85\u8BDD",tip:""}],o.push(t);else{if(0<t.items.length&&t.items[0].data?.itemid?.includes("top_title"))continue;0<t.items.length&&(t.items=Object.values(t.items).filter(i=>i.category=="feed"||i.category=="card")),o.push(t)}else{if(t.data?.card_type&&-1<[202,200].indexOf(t.data.card_type))continue;o.push(t)}return e.items=o,log("removeMain success"),e}function topicHandler(e){const o=e.cards;if(!o||!mainConfig.removeUnfollowTopic&&!mainConfig.removeUnusedPart)return e;let t=[];for(let i of o){let n=!0;if(i.mblog){let r=i.mblog.buttons;mainConfig.removeUnfollowTopic&&r&&r[0].type=="follow"&&(n=!1)}else{if(!mainConfig.removeUnusedPart)continue;if(i.itemid=="bottom_mix_activity")n=!1;else if(i?.top?.title=="\u6B63\u5728\u6D3B\u8DC3")n=!1;else if(i.card_type==200&&i.group)n=!1;else{let r=i.card_group;if(!r)continue;let d=r[0];if(-1<["guess_like_title","cats_top_title","chaohua_home_readpost_samecity_title"].indexOf(d.itemid))n=!1;else if(1<r.length){let s=[];for(let a of r)["chaohua_discovery_banner_1","bottom_mix_activity"].indexOf(a.itemid)==-1&&s.push(a);i.card_group=s}}}n&&t.push(i)}return e.cards=t,log("topicHandler success"),e}function removeSearchMain(e){let o=e.channelInfo.channels;if(!o)return e;let t=[];for(let i of o)i.payload&&(removeSearch(i.payload),delete i.titleInfoAbsorb,delete i.titleInfo,delete i.title,t.push(i));return e.channelInfo.channels=t,e.header?.data&&removeHeader(e.header.data),e.channelInfo?.moreChannels&&(delete e.channelInfo.moreChannels,delete e.channelInfo.channelConfig),log("remove_search main success"),e}function removeHeader(e){if(!e.items)return e;let o=[];for(let t of e.items)t.category=="group"&&(t.items=t.items.filter(i=>i.data?.card_type==null||i.data?.card_type===101||i.data?.card_type===17),0<t.items.length&&o.push(t));return log("remove Header success"),e.items=o,e}function checkSearchWindow(e){return!!mainConfig.removeSearchWindow&&e.category=="card"&&(e.data?.itemid=="finder_window"||e.data?.itemid=="discover_gallery"||e.data?.itemid=="more_frame"||e.data?.card_type==208||e.data?.card_type==236||e.data?.card_type==247||e.data?.card_type==217||e.data?.card_type==101||e.data?.card_type==19||e.data?.mblog?.page_info?.actionlog?.source?.includes("ad")||e.data?.pic?.includes("ads"))}function removeSearch(e){if(!e.items)return e;let o=[];for(let t of e.items)t.category=="feed"?isAd(t.data)||(t.data?.page_info?.video_limit&&delete t.data.page_info.video_limit,o.push(t)):t.category=="group"?t.header?.type!=="guess"&&(t.items=t.items.filter(i=>i.data?.card_type==null||i.data?.card_type===17||i.data?.card_type===10),0<t.items.length&&o.push(t)):checkSearchWindow(t)||o.push(t);return e.items=o,e.loadedInfo&&(e.loadedInfo.searchBarContent=[],e.loadedInfo.headerBack&&(e.loadedInfo.headerBack.channelStyleMap={})),log("remove_search success"),e}function removeMsgAd(e){if(e.messages){let o=[];for(let t of e.messages)t.msg_card?.ad_tag||o.push(t);return e.messages=o,e}}function removePage(e){return removeCards(e),mainConfig.removePinedTrending&&e.cards&&0<e.cards.length&&e.cards[0].card_group&&(e.cards[0].card_group=e.cards[0].card_group.filter(o=>!(o?.actionlog?.ext?.includes("ads_word")||o?.itemid?.includes("t:51")||o?.itemid?.includes("ads_word")))),e}function removeCards(e){if(e.hotwords&&(e.hotwords=[]),e.cards){let t=[];for(let i of e.cards){if(e.cardlistInfo?.containerid=="232082type=1"&&(i.card_type==17||i.card_type==58||i.card_type==11)){var o=i.card_type+1;i={card_type:o}}let n=i.card_group;if(n&&0<n.length){let r=[];for(const d of n)d.card_type==118||isAd(d.mblog)||JSON.stringify(d).indexOf("res_from:ads")!=-1||r.push(d);i.card_group=r,t.push(i)}else{let r=i.card_type;if(-1<[9,165].indexOf(r))isAd(i.mblog)||t.push(i);else{if(-1<[1007,180].indexOf(r))continue;t.push(i)}}}e.cards=t}e.items&&(log("data.items"),removeSearch(e))}function lvZhouHandler(e){if(mainConfig.removeLvZhou&&e){let o=e.common_struct;if(o){let t=[];for(const i of o)i.name!="\u7EFF\u6D32"&&t.push(i);e.common_struct=t}}}function isBlock(e){let o=mainConfig.blockIds||[];if(o.length===0)return!1;let t=e.user.id;for(const i of o)if(i==t)return!0;return!1}function removeTimeLine(e){for(const o of["ad","advertises","trends","headers"])e[o]&&delete e[o];if(e.statuses){let o=[];for(const t of e.statuses)isAd(t)||(lvZhouHandler(t),t.common_struct&&delete t.common_struct,t.category?t.category!="group"&&o.push(t):o.push(t));e.statuses=o}}function removeHomeVip(e){return e.header&&e.header.vipView&&(e.header.vipView=null),e}function removeVideoRemind(e){e.bubble_dismiss_time=0,e.exist_remind=!1,e.image_dismiss_time=0,e.image="",e.tag_image_english="",e.tag_image_english_dark="",e.tag_image_normal="",e.tag_image_normal_dark=""}function itemExtendHandler(e){if((mainConfig.removeRelate||mainConfig.removeGood)&&e.trend&&e.trend.titles){let o=e.trend.titles.title;(mainConfig.removeRelate&&o==="\u76F8\u5173\u63A8\u8350"||mainConfig.removeGood&&o==="\u535A\u4E3B\u597D\u7269\u79CD\u8349")&&delete e.trend}mainConfig.removeFollow&&e.follow_data&&(e.follow_data=null),mainConfig.removeRewardItem&&e.reward_info&&(e.reward_info=null),e.head_cards&&delete e.head_cards,e.page_alerts&&(e.page_alerts=null);try{-1<e.trend.extra_struct.extBtnInfo.btn_picurl.indexOf("timeline_icon_ad_delete")&&delete e.trend}catch{}if(mainConfig.modifyMenus&&e.custom_action_list){let o=[];for(const t of e.custom_action_list){let i=t.type,n=itemMenusConfig[i];n===void 0?o.push(t):i==="mblog_menus_copy_url"?o.unshift(t):n&&o.push(t)}e.custom_action_list=o}}function updateFollowOrder(e){try{for(let o of e.items)if(o.itemId==="mainnums_friends"){let t=o.click.modules[0].scheme;return o.click.modules[0].scheme=t.replace("231093_-_selfrecomm","231093_-_selffollowed"),void log("updateFollowOrder success")}}catch{}}function updateProfileSkin(e,o){try{let t=mainConfig[o];if(!t)return;let i=0;for(let n of e.items)if(n.image)try{dm=n.image.style.darkMode,dm!="alpha"&&(n.image.style.darkMode="alpha"),n.image.iconUrl=t[i++],n.dot&&(n.dot=[])}catch{}log("updateProfileSkin success")}catch{}}function removeHome(e){if(!e.items)return e;let o=[];for(let t of e.items){let i=t.itemId;if(i=="profileme_mine")mainConfig.removeHomeVip&&(t=removeHomeVip(t)),t.header?.vipIcon&&delete t.header.vipIcon,updateFollowOrder(t),o.push(t);else if(i=="100505_-_top8")updateProfileSkin(t,"profileSkin1"),o.push(t);else if(i=="100505_-_newcreator")t.type=="grid"?(updateProfileSkin(t,"profileSkin2"),o.push(t)):!mainConfig.removeHomeCreatorTask&&o.push(t);else if(i=="100505_-_chaohua"||i=="100505_-_manage"||i=="100505_-_recentlyuser")0<t.images?.length&&(t.images=t.images.filter(n=>n.itemId=="100505_-_chaohua"||n.itemId=="100505_-_recentlyuser")),o.push(t);else continue}return e.items=o,e}function removeCheckin(e){log("remove tab1\u7B7E\u5230"),e.show=0}function removeMediaHomelist(e){mainConfig.removeLiveMedia&&(log("remove \u9996\u9875\u76F4\u64AD"),e.data={})}function removeComments(e){let o=["\u5E7F\u544A","\u5EE3\u544A","\u76F8\u5173\u5185\u5BB9","\u63A8\u8350","\u70ED\u63A8","\u63A8\u85A6"],t=e.datas||[];if(t.length!==0){let i=[];for(const n of t){let r=n.adType||"";o.indexOf(r)==-1&&n.type!=6&&i.push(n)}log("remove \u8BC4\u8BBA\u533A\u76F8\u5173\u548C\u63A8\u8350\u5185\u5BB9"),e.datas=i,e.tip_msg&&delete e.tip_msg}}function containerHandler(e){mainConfig.removeInterestFriendInTopic&&e.card_type_name==="\u8D85\u8BDD\u91CC\u7684\u597D\u53CB"&&(log("remove \u8D85\u8BDD\u91CC\u7684\u597D\u53CB"),e.card_group=[]),mainConfig.removeInterestTopic&&e.itemid&&(-1<e.itemid.indexOf("infeed_may_interest_in")?(log("remove \u611F\u5174\u8DA3\u7684\u8D85\u8BDD"),e.card_group=[]):-1<e.itemid.indexOf("infeed_friends_recommend")&&(log("remove \u8D85\u8BDD\u597D\u53CB\u5173\u6CE8"),e.card_group=[]))}function userHandler(e){if(e=removeMainTab(e),!mainConfig.removeInterestUser||!e.items)return e;let o=[];for(let t of e.items){let i=!0;if(t.category=="group")try{t.items[0].data.desc=="\u53EF\u80FD\u611F\u5174\u8DA3\u7684\u4EBA"&&(i=!1)}catch{}i&&(t.data?.common_struct&&delete t.data.common_struct,o.push(t))}return e.items=o,log("removeMain sub success"),e}function nextVideoHandler(e){if(!e.statuses)return e;let o=[];for(let t of e.statuses)if(!isAd(t)){const i=["forward_redpacket_info","shopping","float_info","tags"];for(const n of i)t.video_info?.[n]&&delete t.video_info[n];o.push(t)}return e.statuses=o,log("removeMainTab Success"),e}function tabSkinHandler(e){try{let o=mainConfig.tabIconVersion;if(e.data.canUse=1,!o||!mainConfig.tabIconPath||100>o)return;let t=e.data.list;for(let i of t)i.version=o,i.downloadlink=mainConfig.tabIconPath;log("tabSkinHandler success")}catch{log("tabSkinHandler fail")}}function skinPreviewHandler(e){e.data.skin_info.status=1}function removeLuaScreenAds(e){if(!e.cached_ad)return e;for(let o of e.cached_ad.ads)o.start_date=1893254400,o.show_count=0,o.duration=0,o.end_date=1893340799;return e}function removePhpScreenAds(e){if(!e.ads)return e;e.show_push_splash_ad=!1,e.background_delay_display_time=0,e.lastAdShow_delay_display_time=0,e.realtime_ad_video_stall_time=0,e.realtime_ad_timeout_duration=0;for(let o of e.ads)o.displaytime=0,o.displayintervel=86400,o.allowdaydisplaynum=0,o.displaynum=0,o.displaytime=1,o.begintime="2029-12-30 00:00:00",o.endtime="2029-12-30 23:59:59";return e}function log(e){mainConfig.isDebug}var body=$response.body,url=$request.url;let method=getModifyMethod(url);if(method){log(method);var func=eval(method);let data=JSON.parse(body.match(/\{.*\}/)[0]);new func(data),body=JSON.stringify(data),method=="removePhpScreenAds"&&(body=JSON.stringify(data)+"OK")}$done({body});
