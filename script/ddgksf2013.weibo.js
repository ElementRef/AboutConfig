// Wed Aug 13 2025 21:21:45 GMT+0000 (Coordinated Universal Time) https://raw.githubusercontent.com/ElementRef/AboutConfig/main/script/ddgksf2013.weibo.js
const version="V2.0.138",mainConfig={isDebug:!1,author:"ddgksf2013",removeHomeVip:!0,removeHomeCreatorTask:!0,removeRelate:!0,removeGood:!0,removeFollow:!0,modifyMenus:!0,removeRelateItem:!1,removeRecommendItem:!0,removeRewardItem:!0,removeLiveMedia:!0,removeNextVideo:!1,removePinedTrending:!0,removeInterestFriendInTopic:!1,removeInterestTopic:!1,removeInterestUser:!0,removeLvZhou:!0,removeSearchWindow:!0,profileSkin1:null,profileSkin2:null,tabIconVersion:0,tabIconPath:""},itemMenusConfig={creator_task:!1,mblog_menus_custom:!1,mblog_menus_video_later:!0,mblog_menus_comment_manager:!0,mblog_menus_avatar_widget:!1,mblog_menus_card_bg:!1,mblog_menus_long_picture:!0,mblog_menus_delete:!0,mblog_menus_edit:!0,mblog_menus_edit_history:!0,mblog_menus_edit_video:!0,mblog_menus_sticking:!0,mblog_menus_open_reward:!0,mblog_menus_novelty:!1,mblog_menus_favorite:!0,mblog_menus_promote:!0,mblog_menus_modify_visible:!0,mblog_menus_copy_url:!0,mblog_menus_follow:!0,mblog_menus_video_feedback:!0,mblog_menus_shield:!0,mblog_menus_report:!0,mblog_menus_apeal:!0,mblog_menus_home:!0},modifyCardsUrls=["/cardlist","video/community_tab","searchall"],modifyStatusesUrls=["statuses/friends/timeline","statuses_unread_hot_timeline","statuses/unread_friends_timeline","statuses/unread_hot_timeline","groups/timeline","statuses/friends_timeline"],otherUrls={"/profile/me":"removeHome","/statuses/extend":"itemExtendHandler","/video/remind_info":"removeVideoRemind","/checkin/show":"removeCheckin","/live/media_homelist":"removeMediaHomelist","/comments/build_comments":"removeComments","/container/get_item":"containerHandler","/profile/container_timeline":"userHandler","/video/tiny_stream_video_list":"nextVideoHandler","/2/statuses/video_mixtimeline":"nextVideoHandler","video/tiny_stream_mid_detail":"nextVideoHandler","/!/client/light_skin":"tabSkinHandler","/littleskin/preview":"skinPreviewHandler","/search/finder":"removeSearchMain","/search/container_timeline":"removeSearch","/search/container_discover":"removeSearch","/2/messageflow":"removeMsgAd","/2/page?":"removePage","/statuses/unread_topic_timeline":"topicHandler","/square&pageDataType/":"squareHandler","/statuses/container_timeline_topic":"removeMain","/statuses/container_timeline":"removeMainTab","wbapplua/wbpullad.lua":"removeLuaScreenAds","interface/sdk/sdkad.php":"removePhpScreenAds","a=trends":"removeTopics",user_center:"modifiedUserCenter","a=get_coopen_ads":"removeIntlOpenAds","php?a=search_topic":"removeSearchTopic","ad/realtime":"removeRealtimeAd","ad/preload":"removeAdPreload","php?a=open_app":"removeAdBanner"};function getModifyMethod(e){for(const i of modifyCardsUrls)if(-1<e.indexOf(i))return"removeCards";for(const i of modifyStatusesUrls)if(-1<e.indexOf(i))return"removeTimeLine";for(var[o,a]of Object.entries(otherUrls))if(-1<e.indexOf(o))return a;return null}function removeRealtimeAd(e){return delete e.ads,e.code=4016,e}function removeAdBanner(e){return e.data.close_ad_setting&&delete e.data.close_ad_setting,e.data.detail_banner_ad&&(e.data.detail_banner_ad=[]),e}function removeAdPreload(e){if(e.ads){e.last_ad_show_interval=86400;for(var o of e.ads)o.start_time=2681574400,o.end_time=2681660799,o.display_duration=0,o.daily_display_cnt=0,o.total_display_cnt=0}return e}function removeIntlOpenAds(e){return e.data&&(e.data={display_ad:1}),e}function removeSearchTopic(e){return e.data&&e.data.search_topic?.cards.length!==0&&(e.data.search_topic.cards=Object.values(e.data.search_topic.cards).filter(o=>o.type!="searchtop"),e.data.trending_topic)&&delete e.data.trending_topic,e}function modifiedUserCenter(e){return e.data&&e.data.length!==0&&e.data.cards&&(e.data.cards=Object.values(e.data.cards).filter(o=>o.items[0].type!="personal_vip")),e}function removeTopics(e){return e.data&&(e.data.order=["search_topic"]),e}function isAd(e){return!!e&&(e.mblogtypename=="\u5E7F\u544A"||e.mblogtypename=="\u70ED\u63A8"||e.promotion?.type=="ad"||e.page_info?.actionlog?.source=="ad"||e.content_auth_info?.content_auth_title=="\u5E7F\u544A")}function squareHandler(e){return e.items,e}function removeMainTab(e){if(e.loadedInfo&&e.loadedInfo.headers&&delete e.loadedInfo.headers,e.items){var o,a=[];for(o of e.items)isAd(o.data)||(o.data?.page_info?.video_limit&&delete o.data.page_info.video_limit,o.data?.common_struct&&delete o.data.common_struct,o.category&&o.category=="group"&&JSON.stringify(o.items).indexOf("profile_top")==-1)||a.push(o);e.items=a,log("removeMainTab success")}return e}function removeMain(e){if(e.loadedInfo&&e.loadedInfo.headers&&delete e.loadedInfo.headers,e.items){var o,a=[];for(o of e.items)o.category=="feed"?isAd(o.data)||a.push(o):o.category=="group"?0<o.items.length&&o.items[0].data?.itemid?.includes("search_input")?(o.items=o.items.filter(i=>i?.data?.itemid?.includes("mine_topics")||i?.data?.itemid?.includes("search_input")||i?.data?.card_type==202),o.items[0].data.hotwords=[{word:"\u641C\u7D22\u8D85\u8BDD",tip:""}],a.push(o)):0<o.items.length&&o.items[0].data?.itemid?.includes("top_title")||(0<o.items.length&&(o.items=Object.values(o.items).filter(i=>i.category==="feed"||i.category==="card")),a.push(o)):o.data?.card_type&&-1<[202,200].indexOf(o.data.card_type)||a.push(o);e.items=a,log("removeMain success")}return e}function topicHandler(e){var o=e.cards;if(o&&(mainConfig.removeUnfollowTopic||mainConfig.removeUnusedPart)){var a,i=[];for(a of o){let d=!0;if(a.mblog){var r=a.mblog.buttons;mainConfig.removeUnfollowTopic&&r&&r[0].type=="follow"&&(d=!1)}else{if(!mainConfig.removeUnusedPart)continue;if(a.itemid=="bottom_mix_activity")d=!1;else if(a?.top?.title=="\u6B63\u5728\u6D3B\u8DC3")d=!1;else if(a.card_type==200&&a.group)d=!1;else{if(r=a.card_group,!r)continue;var t=r[0];if(-1<["guess_like_title","cats_top_title","chaohua_home_readpost_samecity_title"].indexOf(t.itemid))d=!1;else if(1<r.length){var n,s=[];for(n of r)["chaohua_discovery_banner_1","bottom_mix_activity"].indexOf(n.itemid)==-1&&s.push(n);a.card_group=s}}}d&&i.push(a)}e.cards=i,log("topicHandler success")}return e}function removeSearchMain(e){var o=e.channelInfo.channels;if(o){var a,i=[];for(a of o)a.payload&&(removeSearch(a.payload),delete a.titleInfoAbsorb,delete a.titleInfo,delete a.title,i.push(a));e.channelInfo.channels=i,e.header?.data&&removeHeader(e.header.data),e.channelInfo?.moreChannels&&(delete e.channelInfo.moreChannels,delete e.channelInfo.channelConfig),log("remove_search main success")}return e}function removeHeader(e){if(e.items){var o,a=[];for(o of e.items)o.category=="group"&&(o.items=o.items.filter(i=>i.data?.card_type==null||i.data?.card_type===101||i.data?.card_type===17),0<o.items.length)&&a.push(o);log("remove Header success"),e.items=a}return e}function checkSearchWindow(e){return!!mainConfig.removeSearchWindow&&e.category=="card"&&(e.data?.itemid=="finder_window"||e.data?.itemid=="discover_gallery"||e.data?.itemid=="more_frame"||e.data?.card_type==208||e.data?.card_type==236||e.data?.card_type==247||e.data?.card_type==217||e.data?.card_type==101||e.data?.card_type==19||e.data?.mblog?.page_info?.actionlog?.source?.includes("ad")||e.data?.pic?.includes("ads"))}function removeSearch(e){if(e.items){var o,a=[];for(o of e.items)o.category=="feed"?isAd(o.data)||(o.data?.page_info?.video_limit&&delete o.data.page_info.video_limit,a.push(o)):o.category=="group"?o.header?.type!=="guess"&&(o.items=o.items.filter(i=>(i.data?.card_type===void 0||i.data?.card_type===17||i.data?.card_type===10)&&i.data?.content_auth_info?.content_auth_title!=="\u5E7F\u544A"),0<o.items.length)&&a.push(o):checkSearchWindow(o)||a.push(o);e.items=a,e.loadedInfo&&(e.loadedInfo.searchBarContent=[],e.loadedInfo.headerBack)&&(e.loadedInfo.headerBack.channelStyleMap={}),log("remove_search success")}return e}function removeMsgAd(e){if(e.messages){var o,a=[];for(o of e.messages)o.msg_card?.ad_tag||a.push(o);return e.messages=a,e}}function removePage(e){return removeCards(e),mainConfig.removePinedTrending&&e.cards&&0<e.cards.length&&e.cards[0].card_group&&(e.cards[0].card_group=e.cards[0].card_group.filter(o=>!(o?.actionlog?.ext?.includes("ads_word")||o?.itemid?.includes("t:51")||o?.itemid?.includes("ads_word")))),e}function removeCards(e){if(e.hotwords&&(e.hotwords=[]),e.cards){var o,a=[];for(o of e.cards){e.cardlistInfo?.containerid!="232082type=1"||o.card_type!=17&&o.card_type!=58&&o.card_type!=11||(i=o.card_type+1,o={card_type:i});var i=o.card_group;if(i&&0<i.length){var r=[];for(const n of i)n.card_type==118||isAd(n.mblog)||JSON.stringify(n).indexOf("res_from:ads")==-1&&r.push(n);o.card_group=r,a.push(o)}else{var t=o.card_type;-1<[9,165].indexOf(t)?isAd(o.mblog)||a.push(o):-1<[1007,180].indexOf(t)||a.push(o)}}e.cards=a}e.items&&(log("data.items"),removeSearch(e))}function lvZhouHandler(e){if(mainConfig.removeLvZhou&&e){var o=e.common_struct;if(o){var a=[];for(const i of o)i.name!="\u7EFF\u6D32"&&a.push(i);e.common_struct=a}}}function isBlock(e){var o=mainConfig.blockIds||[];if(o.length!==0){var a=e.user.id;for(const i of o)if(i==a)return!0}return!1}function removeTimeLine(e){for(const a of["ad","advertises","trends","headers"])e[a]&&delete e[a];if(e.statuses){var o=[];for(const a of e.statuses)isAd(a)||(lvZhouHandler(a),a.common_struct&&delete a.common_struct,a.category&&a.category=="group")||o.push(a);e.statuses=o}}function removeHomeVip(e){return e.header&&e.header.vipView&&(e.header.vipView=null),e}function removeVideoRemind(e){e.bubble_dismiss_time=0,e.exist_remind=!1,e.image_dismiss_time=0,e.image="",e.tag_image_english="",e.tag_image_english_dark="",e.tag_image_normal="",e.tag_image_normal_dark=""}function itemExtendHandler(e){var o;(mainConfig.removeRelate||mainConfig.removeGood)&&e.trend&&e.trend.titles&&(o=e.trend.titles.title,mainConfig.removeRelate&&o==="\u76F8\u5173\u63A8\u8350"||mainConfig.removeGood&&o==="\u535A\u4E3B\u597D\u7269\u79CD\u8349")&&delete e.trend,mainConfig.removeFollow&&e.follow_data&&(e.follow_data=null),mainConfig.removeRewardItem&&e.reward_info&&(e.reward_info=null),e.head_cards&&delete e.head_cards,e.page_alerts&&(e.page_alerts=null);try{-1<e.trend.extra_struct.extBtnInfo.btn_picurl.indexOf("timeline_icon_ad_delete")&&delete e.trend}catch{}if(mainConfig.modifyMenus&&e.custom_action_list){var a=[];for(const t of e.custom_action_list){var i=t.type,r=itemMenusConfig[i];r===void 0?a.push(t):i==="mblog_menus_copy_url"?a.unshift(t):r&&a.push(t)}e.custom_action_list=a}}function updateFollowOrder(e){try{for(var o of e.items){var a;if(o.itemId==="mainnums_friends")return a=o.click.modules[0].scheme,o.click.modules[0].scheme=a.replace("231093_-_selfrecomm","231093_-_selffollowed"),void log("updateFollowOrder success")}}catch{}}function updateProfileSkin(e,o){try{var a=mainConfig[o];if(a){let r=0;for(var i of e.items)if(i.image)try{(dm=i.image.style.darkMode)!="alpha"&&(i.image.style.darkMode="alpha"),i.image.iconUrl=a[r++],i.dot&&(i.dot=[])}catch{}log("updateProfileSkin success")}}catch{}}function removeHome(e){if(e.items){var o,a=[];for(o of e.items){var i=o.itemId;i=="profileme_mine"?((o=mainConfig.removeHomeVip?removeHomeVip(o):o).header?.vipIcon&&delete o.header.vipIcon,updateFollowOrder(o),a.push(o)):i=="100505_-_top8"?(updateProfileSkin(o,"profileSkin1"),a.push(o)):i=="100505_-_newcreator"?o.type=="grid"?(updateProfileSkin(o,"profileSkin2"),a.push(o)):mainConfig.removeHomeCreatorTask||a.push(o):i!="100505_-_chaohua"&&i!="100505_-_manage"&&i!="100505_-_recentlyuser"||(0<o.images?.length&&(o.images=o.images.filter(r=>r.itemId=="100505_-_chaohua"||r.itemId=="100505_-_recentlyuser")),a.push(o))}e.items=a}return e}function removeCheckin(e){log("remove tab1\u7B7E\u5230"),e.show=0}function removeMediaHomelist(e){mainConfig.removeLiveMedia&&(log("remove \u9996\u9875\u76F4\u64AD"),e.data={})}function removeComments(e){var o=["\u5E7F\u544A","\u5EE3\u544A","\u76F8\u5173\u5185\u5BB9","\u63A8\u8350","\u70ED\u63A8","\u63A8\u85A6"],a=e.datas||[];if(a.length!==0){var i=[];for(const t of a){var r=t.adType||"";o.indexOf(r)==-1&&t.type!=6&&i.push(t)}log("remove \u8BC4\u8BBA\u533A\u76F8\u5173\u548C\u63A8\u8350\u5185\u5BB9"),e.datas=i,e.tip_msg&&delete e.tip_msg}}function containerHandler(e){mainConfig.removeInterestFriendInTopic&&e.card_type_name==="\u8D85\u8BDD\u91CC\u7684\u597D\u53CB"&&(log("remove \u8D85\u8BDD\u91CC\u7684\u597D\u53CB"),e.card_group=[]),mainConfig.removeInterestTopic&&e.itemid&&(-1<e.itemid.indexOf("infeed_may_interest_in")?(log("remove \u611F\u5174\u8DA3\u7684\u8D85\u8BDD"),e.card_group=[]):-1<e.itemid.indexOf("infeed_friends_recommend")&&(log("remove \u8D85\u8BDD\u597D\u53CB\u5173\u6CE8"),e.card_group=[]))}function userHandler(e){if(e=removeMainTab(e),mainConfig.removeInterestUser&&e.items){var o,a=[];for(o of e.items){let i=!0;if(o.category=="group")try{o.items[0].data.desc=="\u53EF\u80FD\u611F\u5174\u8DA3\u7684\u4EBA"&&(i=!1)}catch{}i&&(o.data?.common_struct&&delete o.data.common_struct,a.push(o))}e.items=a,log("removeMain sub success")}return e}function nextVideoHandler(e){if(e.statuses){var o,a=[];for(o of e.statuses)if(!isAd(o)){for(const i of["forward_redpacket_info","shopping","float_info","tags"])o.video_info?.[i]&&delete o.video_info[i];a.push(o)}e.statuses=a,log("removeMainTab Success")}return e}function tabSkinHandler(e){try{var o,a=mainConfig.tabIconVersion;if(e.data.canUse=1,a&&mainConfig.tabIconPath&&!(a<100)){for(o of e.data.list)o.version=a,o.downloadlink=mainConfig.tabIconPath;log("tabSkinHandler success")}}catch{log("tabSkinHandler fail")}}function skinPreviewHandler(e){e.data.skin_info.status=1}function removeLuaScreenAds(e){if(e.cached_ad)for(var o of e.cached_ad.ads)o.start_date=1893254400,o.show_count=0,o.duration=0,o.end_date=1893340799;return e}function removePhpScreenAds(e){if(e.ads){e.show_push_splash_ad=!1,e.background_delay_display_time=0,e.lastAdShow_delay_display_time=0,e.realtime_ad_video_stall_time=0,e.realtime_ad_timeout_duration=0;for(var o of e.ads)o.displaytime=0,o.displayintervel=86400,o.allowdaydisplaynum=0,o.displaynum=0,o.displaytime=1,o.begintime="2029-12-30 00:00:00",o.endtime="2029-12-30 23:59:59"}return e}function log(e){mainConfig.isDebug}var body=$response.body,url=$request.url;let method=getModifyMethod(url);if(method){log(method);var func=eval(method);let data=JSON.parse(body.match(/\{.*\}/)[0]);new func(data),body=JSON.stringify(data),method=="removePhpScreenAds"&&(body=JSON.stringify(data)+"OK")}$done({body});
